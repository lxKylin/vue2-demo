"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["8160"],{85283:function(e,t,r){r.r(t),r.d(t,{Log:()=>c,LogRenderer:()=>u});var s=r(9787),n=r(65758),i=r(47755),o=r(68333),l={30:"black",31:"red",32:"green",33:"yellow",34:"blue",35:"magenta",36:"cyan",37:"white",90:"grey"},a={40:"black",41:"red",42:"green",43:"yellow",44:"blue",45:"magenta",46:"cyan",47:"white"},c=function(e){function t(t){var r=e.call(this,t)||this;return r.isDone=!1,r.autoScroll=!1,r.state={lastLine:"",logs:[],originLastLine:"",originLogs:[],refresh:!0,showLineNumber:!1,filterWord:""},r.refresh=function(e){var t=r.state.refresh;r.setState({refresh:!t}),t||(r.clear(e),r.loadLogs()),e.preventDefault()},r.clear=function(e){r.setState({logs:r.logs=[],lastLine:r.lastLine="",originLogs:[],originLastLine:""}),null==e||e.preventDefault()},r.filterWord=function(e,t,s){var n=e,i=t;""!==s&&null!=s&&s.length>0&&(e=e.filter(function(e){return e.includes(s)}),t.includes(s)||(t="")),r.setState({filterWord:s,lastLine:r.lastLine=t,logs:r.logs=e,originLogs:n,originLastLine:i})},r.addLines=function(e){e=e.concat();var t=r.props.maxLength,s=r.lastLine||"",n=(r.logs||[]).concat();1===e.length?(s+=e[0],r.setState({lastLine:r.lastLine=s})):(e[0]=s+(e[0]||""),s=e.pop()||"",t&&n.length+e.length>t&&n.splice(0,n.length+e.length-t),n=n.concat(e),r.filterWord(n,s,r.state.filterWord))},r.logRef=n.createRef(),r.autoScroll=t.autoScroll||!1,r.pauseOrResumeScrolling=r.pauseOrResumeScrolling.bind(r),r}return(0,s.ZT)(t,e),t.prototype.componentWillUnmount=function(){this.logRef&&this.logRef.current&&this.logRef.current.removeEventListener("scroll",this.pauseOrResumeScrolling)},t.prototype.componentDidMount=function(){if(this.autoScroll&&this.logRef&&this.logRef.current&&this.logRef.current.addEventListener("scroll",this.pauseOrResumeScrolling),this.props.source){var e="string"==typeof this.props.source?(0,i.OgC)(this.props.source,this.props.data,"| raw"):this.props.source;e&&(0,i.X1t)(e)?this.loadLogs():("string"==typeof e||Array.isArray(e)&&e.every(function(e){return"string"==typeof e}))&&(this.clear(),this.addLines(Array.isArray(e)?e:[e]))}},t.prototype.componentDidUpdate=function(e){if(this.autoScroll&&this.logRef&&this.logRef.current&&(this.logRef.current.scrollTop=this.logRef.current.scrollHeight),this.props.source){var t="string"==typeof this.props.source?(0,i.OgC)(this.props.source,this.props.data,"| raw"):this.props.source;t&&(0,i.X1t)(t)?(0,i.rMT)(e.source,this.props.source,e.data,this.props.data)&&this.loadLogs():("string"==typeof t||Array.isArray(t)&&t.every(function(e){return"string"==typeof e}))&&(0,i.OgC)(e.source,e.data,"| raw")!==t&&t&&(this.clear(),this.addLines(Array.isArray(t)?t:[t]))}},t.prototype.pauseOrResumeScrolling=function(){if(this.logRef&&this.logRef.current){var e=this.logRef.current,t=e.scrollHeight,r=e.scrollTop,s=e.offsetHeight;this.autoScroll=t-(r+s)<50}},t.prototype.loadLogs=function(){var e,t,r;return(0,s.mG)(this,void 0,void 0,function(){var n,o,l,a,c,u,h,p,g,d,f,m,L,v,y,b,E=this;return(0,s.Jh)(this,function(s){switch(s.label){case 0:if(o=(n=this.props).source,l=n.data,a=n.env,c=n.translate,u=n.encoding,n.maxLength,p=void 0===(h=n.credentials)?"include":h,!(g=(0,i.xkX)(o,l)).url)return[2];return[4,fetch(g.url,{method:(null==(e=g.method)?void 0:e.toLocaleUpperCase())||"GET",headers:g.headers||void 0,body:g.data?JSON.stringify(g.data):void 0,credentials:p})];case 1:if(200!==(d=s.sent()).status)return[3,8];if(!(f=d.body))return[2];m=f.getReader(),s.label=2;case 2:if(this.state.refresh)return[3,4];return[4,m.cancel("click cancel button").then(function(){E.props.env.notify("success","日志已经停止刷新")})];case 3:s.sent(),s.label=4;case 4:return[4,m.read()];case 5:if(v=(L=s.sent()).done,(y=L.value)&&(b=new TextDecoder(u).decode(y,{stream:!0}).split("\n"),this.addLines(b)),v)return this.isDone=!0,[2];s.label=6;case 6:return[3,2];case 7:return[3,9];case 8:g.silent||a.notify("error",null!=(r=null==(t=null==g?void 0:g.messages)?void 0:t.failed)?r:c("fetchFailed")),s.label=9;case 9:return[2]}})})},t.prototype.ansiColrToHtml=function(e){if(!0===this.props.disableColor)return e;var t=e.match(/\u001b\[([^m]+)m/);if(t){var r=t[1];if(r){if(e=e.replace(/\u001b[^m]*?m/g,""),r in l)return n.createElement("span",{style:{color:l[r]}},e);if(r in a)return n.createElement("span",{style:{backgroundColor:a[r]}},e.replace(/\u001b[^m]*?m/g,""))}}return e},t.prototype.renderHighlightWord=function(e){var t=this,r=this.props.classnames,s=this.state.filterWord;if(""===s)return this.ansiColrToHtml(e);var i=e.split(s);return i.map(function(e,o){return o<i.length-1?n.createElement("span",null,t.ansiColrToHtml(e),n.createElement("span",{className:r("Log-line-highlight")},s)):e})},t.prototype.renderLine=function(e,t,r){var s=this.props,i=s.classnames;return s.disableColor,n.createElement("div",{className:i("Log-line"),key:e},r&&n.createElement("span",{className:i("Log-line-number")},e+1," "),this.renderHighlightWord(t))},t.prototype.render=function(){var e,t=this,r=this.props,i=r.source,l=r.className,a=r.style,c=r.classnames,u=r.placeholder,h=r.height,p=r.rowHeight,g=(r.disableColor,r.translate),d=r.operation,f=this.state,m=f.refresh,L=f.showLineNumber,v=g(u);i||(v=g("Log.mustHaveSource"));var y=this.state.lastLine?this.state.logs.concat([this.state.lastLine]):this.state.logs;return e=p?n.createElement(o.CP,{height:h,itemCount:y.length,itemSize:p,renderItem:function(e){var r=e.index,i=e.style;return n.createElement("div",{className:c("Log-line"),key:r,style:(0,s.pi)((0,s.pi)({},i),{whiteSpace:"nowrap"})},L&&n.createElement("span",{className:c("Log-line-number")},r+1," "),t.renderHighlightWord(y[r]))}}):y.map(function(e,r){return t.renderLine(r,e,L)}),n.createElement("div",{className:c("Log",l),style:a},n.createElement("div",{className:c("Log-operation")},d&&(null==d?void 0:d.length)>0&&n.createElement(n.Fragment,null,d.includes("stop")&&n.createElement("a",{title:g("stop"),className:m?"":"is-disabled",onClick:this.refresh},n.createElement(o.JO,{icon:"pause"})),d.includes("restart")&&n.createElement("a",{title:g("reload"),className:m?"is-disabled":"",onClick:this.refresh},n.createElement(o.JO,{icon:"refresh"})),d.includes("showLineNumber")&&n.createElement("a",{title:g(L?"Log.notShowLineNumber":"Log.showLineNumber"),onClick:function(e){t.setState({showLineNumber:!L}),e.preventDefault()}},n.createElement(o.JO,{icon:L?"invisible":"view"})),d.includes("clear")&&n.createElement("a",{onClick:this.clear,title:g("clear")},n.createElement(o.JO,{icon:"remove"})),d&&d.includes("filter")&&n.createElement(o.Rj,{className:c("Log-filter-box"),placeholder:"过滤词",onChange:function(e){return t.filterWord(t.state.originLogs,t.state.lastLine,e)},value:this.state.filterWord}))),n.createElement("div",{ref:this.logRef,className:c("Log-body"),style:{height:p?"auto":h}},p||e.length?e:v))},t.defaultProps={height:500,autoScroll:!0,placeholder:"loading",encoding:"utf-8"},t}(n.Component),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t=(0,s.gn)([(0,i.Thl)({type:"log"})],t)}(c)}}]);