"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["4713"],{61568:function(e,t,o){o.r(t),o.d(t,{DrawerRenderer:()=>p,default:()=>c});var n=o(9787),r=o(65758),a=o(47755),i=o(68333),s=o(23293),l=o(97326),d=o(6663),c=function(e){function t(t){var o=e.call(this,t)||this;o.$$id=(0,a.M8z)(),t.store.setEntered(!!t.show),o.handleSelfClose=o.handleSelfClose.bind(o),o.handleAction=o.handleAction.bind(o),o.handleActionSensor=o.handleActionSensor.bind(o),o.handleDrawerConfirm=o.handleDrawerConfirm.bind(o),o.handleDrawerClose=o.handleDrawerClose.bind(o),o.handleDialogConfirm=o.handleDialogConfirm.bind(o),o.handleDialogClose=o.handleDialogClose.bind(o),o.handleChildFinished=o.handleChildFinished.bind(o),o.handleEntered=o.handleEntered.bind(o),o.handleExited=o.handleExited.bind(o),o.handleFormInit=o.handleFormInit.bind(o),o.handleFormChange=o.handleFormChange.bind(o),o.handleFormSaved=o.handleFormSaved.bind(o);var n=t.store;return o.reaction=(0,s.U5)(function(){return"".concat(n.loading).concat(n.error)},function(){return o.forceUpdate()}),o}return(0,n.ZT)(t,e),t.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),clearTimeout(this.clearErrorTimer)},t.prototype.buildActions=function(){var e=this.props,t=e.actions,o=e.confirm,n=e.translate,r=e.testIdBuilder;if(void 0!==t)return t;var a=[];return a.push({type:"button",testIdBuilder:null==r?void 0:r.getChild("cancel"),actionType:"close",label:n("cancel")}),o&&a.push({type:"button",actionType:"confirm",testIdBuilder:null==r?void 0:r.getChild("confirm"),label:n("confirm"),primary:!0}),a},t.prototype.handleSelfClose=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,o,r,a;return(0,n.Jh)(this,function(n){switch(n.label){case 0:if(t=(e=this.props).onClose,o=e.store,r=e.dispatchEvent,!1!==o.dialogOpen||!1!==o.drawerOpen)return[2];return[4,r("cancel",this.props.data)];case 1:if(null==(a=n.sent())?void 0:a.prevented)return[2];if(!(null==a?void 0:a.pendingPromise.length))return[3,3];return[4,a.allDone()];case 2:n.sent(),n.label=3;case 3:return o.updateMessage(),t(),[2]}})})},t.prototype.handleActionSensor=function(e){var t=this.props.store,o=t.busying;t.markBusying(!0),t.updateMessage(),e.then(function(){t.markBusying(o)}).catch(function(e){t.updateMessage(e.message,!0),t.markBusying(o)})},t.prototype.handleAction=function(e,t,o){var n=this.props,r=n.onClose,a=n.onAction;"close"===t.actionType||"cancel"===t.actionType?r():a&&a(e,t,o)},t.prototype.handleDrawerConfirm=function(e,t){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var a=this.props.store;t.mergeData&&1===e.length&&e[0]&&a.updateData(e[0]);var i=a.action.drawer;i.onConfirm&&!1===i.onConfirm.apply(i,(0,n.ev)([e,t],(0,n.CR)(o),!1))||a.closeDrawer(!0,e)},t.prototype.handleDrawerClose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.props.store,r=o.action.drawer;r.onClose&&!1===r.onClose.apply(r,(0,n.ev)([],(0,n.CR)(e),!1))||o.closeDrawer.apply(o,(0,n.ev)([],(0,n.CR)(e),!1))},t.prototype.handleDialogConfirm=function(e,t){for(var o=[],r=2;r<arguments.length;r++)o[r-2]=arguments[r];var a=this.props.store;t.mergeData&&1===e.length&&e[0]&&a.updateData(e[0]);var i=a.action.dialog;i.onConfirm&&!1===i.onConfirm.apply(i,(0,n.ev)([e,t],(0,n.CR)(o),!1))||a.closeDialog(!0,e)},t.prototype.handleDialogClose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o=this.props.store,r=o.action.dialog;r.onClose&&!1===r.onClose.apply(r,(0,n.ev)([],(0,n.CR)(e),!1))||o.closeDialog(e[1])},t.prototype.handleChildFinished=function(e,t){},t.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},t.prototype.handleFormChange=function(e,t){var o=this.props.store;if("string"==typeof t)return void o.changeValue(t,e);o.setFormData(e)},t.prototype.handleFormSaved=function(e,t){this.props.store.setFormData((0,n.pi)((0,n.pi)({},e),t))},t.prototype.handleEntered=function(){var e=this.props,t=e.lazySchema,o=e.store;o.setEntered(!0),o.markBusying(!1),"function"==typeof t&&o.setSchema(t(this.props))},t.prototype.handleExited=function(){var e=this.props,t=e.lazySchema,o=e.store,n=e.statusStore;n&&(0,d.fh)(n)&&n.resetAll(),(0,d.fh)(o)&&(o.reset(),o.clearMessage(),o.markBusying(!1),o.setEntered(!1),"function"==typeof t&&o.setSchema(""))},t.prototype.getPopOverContainer=function(){return(0,l.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Drawer-content"))},t.prototype.renderBody=function(e,t){var o=this,r=this.props,a=r.render,i=r.store;if(Array.isArray(e))return e.map(function(e,t){return o.renderBody(e,t)});var s=e,l={key:t,disabled:i.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:i.loading,syncLocation:!1};return"form"===s.type&&(s=(0,n.pi)({mode:"horizontal",wrapWithPanel:!1,submitText:null},s)),a("body".concat(t?"/".concat(t):""),s,l)},t.prototype.renderFooter=function(){var e=this,t=this.buildActions(),o=this.props.hideActions;if(!t||!t.length||o)return null;var s=this.props,l=s.store,d=s.render,c=s.env,p=s.classnames,h=s.showErrorMsg,u=s.footerClassName,m=s.id,f=s.themeCss;return r.createElement("div",{className:p("Drawer-footer",u,(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerFooterClassName",id:m,themeCss:f})))},l.loading||l.error?r.createElement("div",{className:p("Drawer-info")},r.createElement(i.$j,{size:"sm",key:"info",show:l.loading}),!c.forceSilenceInsideError&&h&&l.error?r.createElement("span",{className:p("Drawer-error")},l.msg):null):null,t.map(function(t,o){return d("action/".concat(o),t,{onAction:e.handleAction,onActionSensor:void 0,btnDisabled:l.loading,data:l.formData,key:o,disabled:t.disabled||l.loading})}))},t.prototype.openFeedback=function(e,t){var o=this;return new Promise(function(n){var r=o.props.store;r.setCurrentAction({type:"button",actionType:"dialog",dialog:e},o.props.resolveDefinitions),r.openDialog(t,void 0,function(e){n(e)},o.context)})},t.prototype.render=function(){var e=this.props.store,t=(0,n.pi)((0,n.pi)({},this.props),e.schema),o=t.className,s=t.style,l=t.size,d=t.closeOnEsc,c=t.position,p=t.title,h=t.render,u=t.header,m=t.body,f=t.bodyClassName,C=t.headerClassName,g=t.show,y=t.showCloseButton,v=t.width,w=t.height,b=t.wrapperComponent,D=t.env,A=t.resizable,T=t.overlay,N=t.closeOnOutside,E=t.classPrefix,O=t.classnames,S=t.drawerContainer,k=t.loadingConfig,x=(t.popOverContainer,t.themeCss),F=t.id,B=(0,n._T)(t,["className","style","size","closeOnEsc","position","title","render","header","body","bodyClassName","headerClassName","show","showCloseButton","width","height","wrapperComponent","env","resizable","overlay","closeOnOutside","classPrefix","classnames","drawerContainer","loadingConfig","popOverContainer","themeCss","id"]),M=b||i.dy;return r.createElement(M,(0,n.pi)({},B,{resizable:A,classPrefix:E,className:o,style:s,drawerClassName:(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerClassName",id:F,themeCss:x})),drawerMaskClassName:(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerMaskClassName",id:F,themeCss:x})),size:l,onHide:this.handleSelfClose,disabled:e.loading,show:g,showCloseButton:y,width:v,height:w,position:c,overlay:T,onEntered:this.handleEntered,onExited:this.handleExited,closeOnEsc:d,closeOnOutside:!e.drawerOpen&&!e.dialogOpen&&N,container:S||(null==D?void 0:D.getModalContainer)}),p||u?r.createElement("div",{className:O("Drawer-header",C,(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerHeaderClassName",id:F,themeCss:x})))},p?r.createElement("div",{className:O("Drawer-title",(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerTitleClassName",id:F,themeCss:x})))},h("title",p,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):null,u?h("header",u,{data:e.formData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null):null,e.entered?m?r.createElement("div",{className:O("Drawer-body",f,(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerBodyClassName",id:F,themeCss:x}))),role:"dialog-body"},this.renderBody(m,"body"),r.createElement(a.cWM,(0,n.pi)({},this.props,{config:{themeCss:x,classNames:[{key:"drawerClassName"},{key:"drawerMaskClassName"},{key:"drawerHeaderClassName"},{key:"drawerTitleClassName"},{key:"drawerBodyClassName"},{key:"drawerFooterClassName"}],id:F},env:D}))):null:r.createElement("div",{className:O("Drawer-body",f,(0,a.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"drawerBodyClassName",id:F,themeCss:x})))},r.createElement(i.$j,{overlay:!0,show:!0,size:"lg",loadingConfig:k})),this.renderFooter(),m?h("dialog",(0,n.pi)((0,n.pi)({},e.action&&e.action.dialog),{type:"dialog"}),{key:"dialog",data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,onAction:this.handleAction,show:e.dialogOpen}):null,m?h("drawer",(0,n.pi)((0,n.pi)({},e.action&&e.action.drawer),{type:"drawer"}),{key:"drawer",data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,onAction:this.handleAction,show:e.drawerOpen}):null)},t.propsList=["title","size","closeOnEsc","closeOnOutside","children","className","bodyClassName","headerClassName","footerClassName","confirm","position","onClose","onConfirm","show","showCloseButton","width","height","resizable","overlay","body","popOverContainer","showErrorMsg"],t.defaultProps={title:"",className:"",bodyClassName:"",headerClassName:"",footerClassName:"",confirm:!0,position:"right",resizable:!1,showCloseButton:!0,overlay:!0,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,n.gn)([a.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"getPopOverContainer",null),t}(r.Component),p=function(e){function t(t,o){var n=e.call(this,t)||this;return o.registerComponent(n),n}return(0,n.ZT)(t,e),t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.prototype.tryChildrenToHandle=function(e,t,o){var r=this,a=this.context,i=[],s=this.props,l=s.onConfirm,d=s.store;if(e.target&&i.push.apply(i,(0,n.ev)([],(0,n.CR)(e.target.split(",").map(function(e){return a.getComponentByName(e)}).filter(function(e){return e&&e.doAction})),!1)),(null==e?void 0:e.isolateScope)!==!0&&!i.length)for(var c=a.getComponents().filter(function(e){return!~["drawer","dialog"].indexOf(e.props.type)}).concat();c.length;){var p=c.pop();if(~["crud","form","wizard"].indexOf(p.props.type)){i.push(p);break}!~["drawer","dialog"].indexOf(p.props.type)&&~["page","service"].indexOf(p.props.type)&&c.unshift.apply(c,p.context.getComponents())}return!!i.length&&(d.markBusying(!0),d.updateMessage(),Promise.all(i.map(function(o){return o.doAction((0,n.pi)((0,n.pi)({},e),{from:r.$$id}),t,!0)})).then(function(n){("submit"===e.type||"submit"===e.actionType||"confirm"===e.actionType)&&!1!==e.close?l&&l(n,o||e,t,i):e.close&&(!0===e.close?r.handleSelfClose():r.closeTarget(e.close)),d.markBusying(!1)}).catch(function(e){d.updateMessage(e.message,!0),d.markBusying(!1),clearTimeout(r.clearErrorTimer),r.clearErrorTimer=setTimeout(function(){d.updateMessage("")},3e3)}),!0)},t.prototype.doAction=function(e,t,o){this.handleAction(void 0,e,t)},t.prototype.handleAction=function(e,t,o,r,i,s){return void 0===r&&(r=!1),(0,n.mG)(this,void 0,void 0,function(){var l,d,c,p,h,u,m,f,C,g,y=this;return(0,n.Jh)(this,function(v){switch(v.label){case 0:if(d=(l=this.props).onClose,c=l.onAction,p=l.store,h=l.env,u=l.dispatchEvent,m=l.show,t.from===this.$$id||!m)return[2,!!c&&c(e,t,o,r,i||this.context)];if(!(null==s?void 0:s.pendingPromise.length))return[3,2];return[4,s.allDone()];case 1:v.sent(),v.label=2;case 2:if(f=this.context,"close"!==t.actionType&&"cancel"!==t.actionType)return[3,6];return[4,u("cancel",(0,a.nW9)(this.props.data,o))];case 3:if(null==(C=v.sent())?void 0:C.prevented)return[2];if(!(null==C?void 0:C.pendingPromise.length))return[3,5];return[4,C.allDone()];case 4:v.sent(),v.label=5;case 5:return p.setCurrentAction(t,this.props.resolveDefinitions),d(),t.close&&(!0===t.close?this.handleSelfClose():this.closeTarget(t.close)),[3,17];case 6:if("confirm"!==t.actionType)return[3,10];return[4,u("confirm",(0,a.nW9)(this.props.data,o))];case 7:if(null==(g=v.sent())?void 0:g.prevented)return[2];if(!(null==g?void 0:g.pendingPromise.length))return[3,9];return[4,g.allDone()];case 8:v.sent(),v.label=9;case 9:return p.setCurrentAction(t,this.props.resolveDefinitions),this.tryChildrenToHandle(t,o)||d(),[3,17];case 10:if("drawer"!==t.actionType)return[3,11];return p.setCurrentAction(t,this.props.resolveDefinitions),[2,new Promise(function(e){p.openDrawer(o,void 0,function(o,n){var r;null==(r=t.callback)||r.call(t,o,n),e({confirmed:o,value:n})})})];case 11:if("dialog"!==t.actionType)return[3,12];return p.setCurrentAction(t,this.props.resolveDefinitions),[2,new Promise(function(e){p.openDialog(o,void 0,function(o,n){var r;null==(r=t.callback)||r.call(t,o,n),e({confirmed:o,value:n})},i||y.context)})];case 12:if("reload"!==t.actionType)return[3,13];return p.setCurrentAction(t,this.props.resolveDefinitions),t.target&&f.reload(t.target,o),t.close&&(!0===t.close?this.handleSelfClose():this.closeTarget(t.close)),[3,17];case 13:if(!(!t.from&&this.tryChildrenToHandle(t,o)))return[3,14];return[3,17];case 14:if("ajax"!==t.actionType)return[3,15];return p.setCurrentAction(t,this.props.resolveDefinitions),p.saveRemote(t.api,o,{successMessage:t.messages&&t.messages.success,errorMessage:t.messages&&t.messages.failed}).then(function(){return(0,n.mG)(y,void 0,void 0,function(){var e;return(0,n.Jh)(this,function(o){switch(o.label){case 0:if(!(t.feedback&&(0,a.pn4)(t.feedback,p.data)))return[3,2];return[4,this.openFeedback(t.feedback,p.data)];case 1:o.sent(),o.label=2;case 2:return(e=t.redirect&&(0,a.hXT)(t.redirect,p.data))&&h.jumpTo(e,t,p.data),t.reload&&this.reloadTarget((0,a.u22)(t.reload,p.data),p.data),t.close&&(!0===t.close?this.handleSelfClose():this.closeTarget(t.close)),[2]}})})}).catch(function(e){if(r||t.countDown)throw e}),[3,17];case 15:if(!c)return[3,17];return[4,c(e,t,o,r,i||this.context)];case 16:v.sent(),t.close&&(!0===t.close?this.handleSelfClose():this.closeTarget(t.close)),v.label=17;case 17:return[2]}})})},t.prototype.handleChildFinished=function(e,t){if((!t||t.from!==this.$$id)&&!1!==t.close){var o=this.context.getComponents().filter(function(e){return!~["drawer","dialog","action","button","submit","reset"].indexOf(e.props.type)}),n=this.props.onConfirm;1===o.length&&("form"===o[0].props.type||"wizard"===o[0].props.type)&&n([e],t,{},o)}},t.prototype.handleDialogConfirm=function(t,o){for(var r,a,i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];e.prototype.handleDialogConfirm.apply(this,(0,n.ev)([t,o],(0,n.CR)(i),!1));var l=this.props.store,d=l.getDialogScoped()||this.context,c=l.action,p=null!=(r=o.reload)?r:c.reload;p?d.reload(p,l.data):d.component!==this&&(null==(a=d.component)?void 0:a.reload)?d.component.reload():this.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},t.prototype.handleDrawerConfirm=function(t,o){for(var n,r=this,a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];e.prototype.handleDrawerConfirm.call(this,t,o);var s=this.props.store,l=s.getDialogScoped()||this.context,d=s.action,c=null!=(n=o.reload)?n:d.reload;setTimeout(function(){var e;c?l.reload(c,s.data):l.component!==r&&(null==(e=l.component)?void 0:e.reload)?l.component.reload():r.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},300)},t.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},t.prototype.closeTarget=function(e){this.context.close(e)},t.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},t.prototype.getData=function(){return this.props.store.data},t.contextType=a.ZHe,t=(0,n.gn)([(0,a.Thl)({type:"drawer",storeType:a.vqG.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,t,o){return!!((e.drawerOpen||t.show)&&(t.show!==o.show||(0,a.RjM)(o.data,t.data)))}}),(0,n.w6)("design:paramtypes",[Object,Object])],t)}(c)}}]);