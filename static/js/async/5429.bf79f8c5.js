"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["5429"],{4745:function(e,o,t){t.r(o),t.d(o,{DialogRenderer:()=>p,default:()=>d});var n=t(9787),a=t(65758),i=t(47755),r=t(68333),s=t(23293),l=t(97326),c=t(6663),d=function(e){function o(o){var t=e.call(this,o)||this;t.isDead=!1,t.$$id=(0,i.M8z)(),o.store.setEntered(!!o.show),t.handleSelfClose=t.handleSelfClose.bind(t),t.handleAction=t.handleAction.bind(t),t.handleActionSensor=t.handleActionSensor.bind(t),t.handleDialogConfirm=t.handleDialogConfirm.bind(t),t.handleDialogClose=t.handleDialogClose.bind(t),t.handleDrawerConfirm=t.handleDrawerConfirm.bind(t),t.handleDrawerClose=t.handleDrawerClose.bind(t),t.handleEntered=t.handleEntered.bind(t),t.handleExited=t.handleExited.bind(t),t.handleFormInit=t.handleFormInit.bind(t),t.handleFormSaved=t.handleFormSaved.bind(t),t.handleFormChange=t.handleFormChange.bind(t),t.handleChildFinished=t.handleChildFinished.bind(t);var n=o.store;return t.reaction=(0,s.U5)(function(){return"".concat(n.loading).concat(n.error)},function(){return t.forceUpdate()}),t}return(0,n.ZT)(o,e),o.prototype.componentWillUnmount=function(){this.reaction&&this.reaction(),this.isDead=!0},o.prototype.buildActions=function(){var e=this.props,o=e.actions,t=e.confirm,n=e.translate,a=e.testIdBuilder;if(void 0!==o)return o;var i=[];return i.push({type:"button",testIdBuilder:null==a?void 0:a.getChild("cancel"),actionType:"cancel",label:n("cancel")}),t&&i.push({type:"button",testIdBuilder:null==a?void 0:a.getChild("confirm"),actionType:"confirm",label:n("confirm"),primary:!0}),i},o.prototype.handleSelfClose=function(e,o){return(0,n.mG)(this,void 0,void 0,function(){var e,t,a,i;return(0,n.Jh)(this,function(n){switch(n.label){case 0:return t=(e=this.props).onClose,a=e.store,[4,(0,e.dispatchEvent)("cancel",this.props.data)];case 1:if(null==(i=n.sent())?void 0:i.prevented)return[2];if(!(null==i?void 0:i.pendingPromise.length))return[3,3];return[4,i.allDone()];case 2:n.sent(),n.label=3;case 3:return a.updateMessage(),t(o),[2]}})})},o.prototype.handleActionSensor=function(e){var o=this,t=this.props.store,n=t.busying;t.markBusying(!0),t.updateMessage(),e.then(function(){t.markBusying(n)}).catch(function(e){o.isDead||(t.updateMessage(e.message,!0),t.markBusying(n))})},o.prototype.handleAction=function(e,o,t){var n=this.props,a=n.store,i=n.onAction;"reset"===o.type?a.reset():"cancel"===o.actionType?this.handleSelfClose():i&&i(e,o,t)},o.prototype.handleDialogConfirm=function(e,o){for(var t=[],a=2;a<arguments.length;a++)t[a-2]=arguments[a];var i=this.props.store;o.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,n.ev)([e,o],(0,n.CR)(t),!1))||i.closeDialog(!0,e)},o.prototype.handleDialogClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,a=t.action.dialog;a.onClose&&!1===a.onClose.apply(a,(0,n.ev)([],(0,n.CR)(e),!1))||t.closeDialog(e[1])},o.prototype.handleDrawerConfirm=function(e,o){for(var t=[],a=2;a<arguments.length;a++)t[a-2]=arguments[a];var i=this.props.store;o.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.drawer;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,n.ev)([e,o],(0,n.CR)(t),!1))||i.closeDrawer(!0,e)},o.prototype.handleDrawerClose=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var t=this.props.store,a=t.action.drawer;a.onClose&&!1===a.onClose.apply(a,(0,n.ev)([],(0,n.CR)(e),!1))||t.closeDrawer.apply(t,(0,n.ev)([],(0,n.CR)(e),!1))},o.prototype.handleEntered=function(){var e=this.props,o=e.lazySchema,t=e.store;t.setEntered(!0),t.markBusying(!1),"function"==typeof o&&t.setSchema(o(this.props));var n=document.activeElement;if(n){var a=(0,l.findDOMNode)(this);a&&!a.contains(n)&&n.blur()}},o.prototype.handleExited=function(){var e=this.props,o=e.lazySchema,t=e.store,n=e.statusStore;n&&(0,c.fh)(n)&&n.resetAll(),(0,c.fh)(t)&&(t.reset(),t.clearMessage(),t.markBusying(!1),t.setEntered(!1),"function"==typeof o&&t.setSchema(""))},o.prototype.handleFormInit=function(e){this.props.store.setFormData(e)},o.prototype.handleFormChange=function(e,o){var t=this.props.store;if("string"==typeof o)return void t.changeValue(o,e);t.setFormData(e)},o.prototype.handleFormSaved=function(e,o){this.props.store.setFormData((0,n.pi)((0,n.pi)({},e),o))},o.prototype.handleChildFinished=function(e,o){},o.prototype.openFeedback=function(e,o){var t=this;return new Promise(function(n){var a=t.props.store;a.setCurrentAction({type:"button",actionType:"dialog",dialog:e},t.props.resolveDefinitions),a.openDialog(o,void 0,function(e){n(e)},t.context)})},o.prototype.getPopOverContainer=function(){return(0,l.findDOMNode)(this).querySelector(".".concat(this.props.classPrefix,"Modal-content"))},o.prototype.renderBody=function(e,o){var t=this,a=this.props,i=a.render,r=a.store;if(Array.isArray(e))return e.map(function(e,o){return t.renderBody(e,o)});var s={key:o,disabled:e&&e.disabled||r.loading,onAction:this.handleAction,onFinished:this.handleChildFinished,popOverContainer:this.getPopOverContainer,onChange:this.handleFormChange,onInit:this.handleFormInit,onSaved:this.handleFormSaved,onActionSensor:this.handleActionSensor,btnDisabled:r.loading,syncLocation:!1};if(!e.type)return i("body".concat(o?"/".concat(o):""),e,s);var l=e;return"form"===l.type&&(l=(0,n.pi)({mode:"horizontal",wrapWithPanel:!1,submitText:null},l)),i("body".concat(o?"/".concat(o):""),l,s)},o.prototype.renderFooter=function(){var e=this,o=this.buildActions(),t=this.props.hideActions;if(!o||!o.length||t)return null;var n=this.props,i=n.store,s=n.render,l=n.env,c=n.classnames,d=n.showErrorMsg,p=n.showLoading,h=n.show,u=n.dialogFooterClassName;return a.createElement("div",{className:c("Modal-footer",u)},!1!==p&&i.loading||!1!==d&&i.error?a.createElement("div",{className:c("Dialog-info"),key:"info"},!1!==p?a.createElement(r.$j,{size:"sm",key:"info",show:i.loading}):null,!l.forceSilenceInsideError&&i.error&&!1!==d?a.createElement("span",{className:c("Dialog-error")},i.msg):null):null,o.map(function(o,t){return s("action/".concat(t),o,{data:i.formData,onAction:e.handleAction,onActionSensor:void 0,btnDisabled:i.loading,key:t,disabled:o.disabled||i.loading||!h})}))},o.prototype.render=function(){var e=this.props.store,o=(0,n.pi)((0,n.pi)({},this.props),e.schema),t=o.className,s=o.style,l=o.size,c=o.height,d=o.width,p=o.closeOnEsc,h=o.closeOnOutside,u=o.title,m=o.render,f=o.header,g=o.body,y=o.bodyClassName,C=o.headerClassName,v=o.show,b=o.lazyRender,D=o.lazySchema,w=o.wrapperComponent,T=o.showCloseButton,E=o.env,A=o.classnames,N=o.classPrefix,S=o.translate,k=o.loadingConfig,x=o.overlay,O=o.dialogType,M=o.cancelText,F=o.confirmText,B=o.confirmBtnLevel,z=o.cancelBtnLevel,P=(o.popOverContainer,o.inDesign,o.themeCss),R=o.id,G=(0,n._T)(o,["className","style","size","height","width","closeOnEsc","closeOnOutside","title","render","header","body","bodyClassName","headerClassName","show","lazyRender","lazySchema","wrapperComponent","showCloseButton","env","classnames","classPrefix","translate","loadingConfig","overlay","dialogType","cancelText","confirmText","confirmBtnLevel","cancelBtnLevel","popOverContainer","inDesign","themeCss","id"]),$=w||r.u_;return a.createElement($,(0,n.pi)({},G,{classPrefix:N,className:A(t),style:s,size:l,height:c,width:d,modalClassName:(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogClassName",id:R,themeCss:P})),modalMaskClassName:(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogMaskClassName",id:R,themeCss:P})),backdrop:"static",onHide:this.handleSelfClose,keyboard:p&&!e.loading,closeOnEsc:p,closeOnOutside:!e.dialogOpen&&h,show:v,onEntered:this.handleEntered,onExited:this.handleExited,container:null==E?void 0:E.getModalContainer,enforceFocus:!1,disabled:e.loading,overlay:x,dialogType:O,cancelText:M,confirmText:F,confirmBtnLevel:B,cancelBtnLevel:z}),u&&"string"==typeof u?a.createElement("div",{className:A("Modal-header",C,(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogHeaderClassName",id:R,themeCss:P})))},!1===T||e.loading?null:a.createElement("a",{"data-tooltip":S("Dialog.close"),"data-position":"left",onClick:this.handleSelfClose,className:A("Modal-close")},a.createElement(r.JO,{icon:"close",className:"icon",iconContent:"Dialog-close"})),a.createElement("div",{className:A("Modal-title",(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogTitleClassName",id:R,themeCss:P})))},(0,i.hXT)(S(u),e.formData))):u?a.createElement("div",{className:A("Modal-header",C,(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogHeaderClassName",id:R,themeCss:P})))},!1===T||e.loading?null:a.createElement("a",{"data-tooltip":S("Dialog.close"),onClick:this.handleSelfClose,className:A("Modal-close")},a.createElement(r.JO,{icon:"close",className:"icon",iconContent:"Dialog-close"})),m("title",u,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading})):!1===T||e.loading?null:a.createElement("a",{"data-tooltip":S("Dialog.close"),onClick:this.handleSelfClose,className:A("Modal-close")},a.createElement(r.JO,{icon:"close",className:"icon",iconContent:"Dialog-close"})),f?m("header",f,{data:e.formData,onAction:this.handleAction,onActionSensor:void 0,btnDisabled:e.loading}):null,!e.entered&&b||D&&!g?a.createElement("div",{className:A("Modal-body",y,(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogBodyClassName",id:R,themeCss:P}))),role:"dialog-body"},a.createElement(r.$j,{overlay:!0,show:!0,size:"lg",loadingConfig:k})):g?a.createElement("div",{className:A("Modal-body",y,(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"dialogBodyClassName",id:R,themeCss:P}))),role:"dialog-body"},this.renderBody(g,"body"),a.createElement(i.cWM,(0,n.pi)({},this.props,{config:{themeCss:P,classNames:[{key:"dialogClassName"},{key:"dialogMaskClassName"},{key:"dialogHeaderClassName"},{key:"dialogTitleClassName"},{key:"dialogBodyClassName"},{key:"dialogFooterClassName"}],id:R},env:E}))):null,g?this.renderFooter():null,g?m("drawer",(0,n.pi)((0,n.pi)({},e.action&&e.action.drawer),{type:"drawer"}),{key:"drawer",data:e.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:e.drawerOpen,onAction:this.handleAction}):null,g?m("dialog",(0,n.pi)((0,n.pi)({},e.action&&e.action.dialog),{type:"dialog"}),{key:"dialog",data:e.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:e.dialogOpen,onAction:this.handleAction}):null)},o.propsList=["title","size","closeOnEsc","closeOnOutside","children","bodyClassName","headerClassName","confirm","onClose","onConfirm","show","body","showCloseButton","showErrorMsg","actions","popOverContainer","overlay","draggable"],o.defaultProps={title:"Dialog.title",bodyClassName:"",confirm:!0,show:!1,lazyRender:!1,showCloseButton:!0,wrapperComponent:r.u_,closeOnEsc:!1,closeOnOutside:!1,showErrorMsg:!0},(0,n.gn)([i.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],o.prototype,"getPopOverContainer",null),o}(a.Component),p=function(e){function o(o,t){var n=e.call(this,o)||this;return t.registerComponent(n),n}return(0,n.ZT)(o,e),o.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this),clearTimeout(this.clearErrorTimer)},o.prototype.tryChildrenToHandle=function(e,o,t){var a=this,i=this.context,r=[],s=this.props,l=s.onConfirm,c=s.store;if(e.target&&r.push.apply(r,(0,n.ev)([],(0,n.CR)(e.target.split(",").map(function(e){return i.getComponentByName(e)}).filter(function(e){return e&&e.doAction})),!1)),(null==e?void 0:e.isolateScope)!==!0&&!r.length)for(var d=i.getComponents().filter(function(e){return!~["drawer","dialog"].indexOf(e.props.type)}).concat();d.length;){var p=d.pop();if(~["crud","form","wizard"].indexOf(p.props.type)){r.push(p);break}!~["drawer","dialog"].indexOf(p.props.type)&&~["page","service"].indexOf(p.props.type)&&d.unshift.apply(d,p.context.getComponents())}return!!r.length&&(c.markBusying(!0),c.updateMessage(),Promise.all(r.map(function(t){return t.doAction((0,n.pi)((0,n.pi)({},e),{from:a.$$id}),o,!0)})).then(function(n){"submit"!==e.type&&"submit"!==e.actionType&&"confirm"!==e.actionType||!1===e.close||r.some(function(e){return!1===e.props.closeDialogOnSubmit})?e.close&&(!0===e.close?a.handleSelfClose():a.closeTarget(e.close)):l&&l(n,t||e,o,r),c.markBusying(!1)}).catch(function(e){a.isDead||(c.updateMessage(e.message,!0),c.markBusying(!1),clearTimeout(a.clearErrorTimer),a.clearErrorTimer=setTimeout(function(){a.isDead||c.updateMessage("")},3e3))}),!0)},o.prototype.doAction=function(e,o,t){this.handleAction(void 0,e,o)},o.prototype.handleAction=function(e,o,t,a,r,s){return void 0===a&&(a=!1),(0,n.mG)(this,void 0,void 0,function(){var l,c,d,p,h,u,m,f,g,y,C,v=this;return(0,n.Jh)(this,function(b){switch(b.label){case 0:if(c=(l=this.props).onAction,d=l.store,p=l.onConfirm,h=l.env,u=l.dispatchEvent,m=l.onClose,f=l.show,o.from===this.$$id||!f)return[2,!!c&&c(e,o,t,a,r||this.context)];if(!(null==s?void 0:s.pendingPromise.length))return[3,2];return[4,s.allDone()];case 1:b.sent(),b.label=2;case 2:if(g=this.context,"reset"!==o.type)return[3,3];return d.setCurrentAction(o,this.props.resolveDefinitions),d.reset(),[3,19];case 3:if("close"!==o.actionType&&"cancel"!==o.actionType)return[3,7];return[4,u("cancel",(0,i.nW9)(this.props.data,t))];case 4:if(null==(y=b.sent())?void 0:y.prevented)return[2];if(!(null==y?void 0:y.pendingPromise.length))return[3,6];return[4,y.allDone()];case 5:b.sent(),b.label=6;case 6:return d.setCurrentAction(o,this.props.resolveDefinitions),d.updateMessage(),m(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[3,19];case 7:if("confirm"!==o.actionType)return[3,11];return[4,u("confirm",(0,i.nW9)(this.props.data,t))];case 8:if(null==(C=b.sent())?void 0:C.prevented)return[2];if(!(null==C?void 0:C.pendingPromise.length))return[3,10];return[4,C.allDone()];case 9:b.sent(),b.label=10;case 10:return d.setCurrentAction(o,this.props.resolveDefinitions),this.tryChildrenToHandle((0,n.pi)((0,n.pi)({},o),{actionType:"submit"}),t,o)||(d.updateMessage(),!1!==o.close&&m(!0)),[3,19];case 11:if("next"!==o.actionType&&"prev"!==o.actionType)return[3,12];return d.setCurrentAction(o,this.props.resolveDefinitions),"submit"===o.type?this.tryChildrenToHandle((0,n.pi)((0,n.pi)({},o),{actionType:"submit",close:!0}),t,o)||this.handleSelfClose(void 0,!0):p([t],o,t,[]),[3,19];case 12:if("dialog"!==o.actionType)return[3,13];return d.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise(function(e){d.openDialog(t,void 0,function(t,n){var a;null==(a=o.callback)||a.call(o,t,n),e({confirmed:t,value:n})},r||v.context)})];case 13:if("drawer"!==o.actionType)return[3,14];return d.setCurrentAction(o,this.props.resolveDefinitions),[2,new Promise(function(e){d.openDrawer(t,void 0,function(t,n){var a;null==(a=o.callback)||a.call(o,t,n),e({confirmed:t,value:n})})})];case 14:if("reload"!==o.actionType)return[3,15];return d.setCurrentAction(o,this.props.resolveDefinitions),o.target&&g.reload(o.target,t),(o.close||"submit"===o.type)&&(this.handleSelfClose(void 0,"submit"===o.type),o.close&&"string"==typeof o.close&&this.closeTarget(o.close)),[3,19];case 15:if(!(!o.from&&this.tryChildrenToHandle(o,t)))return[3,16];return[3,19];case 16:if("ajax"!==o.actionType)return[3,17];return d.setCurrentAction(o,this.props.resolveDefinitions),[2,d.saveRemote(o.api,t,{successMessage:o.messages&&o.messages.success,errorMessage:o.messages&&o.messages.failed}).then(function(){return(0,n.mG)(v,void 0,void 0,function(){var e;return(0,n.Jh)(this,function(t){switch(t.label){case 0:if(!(o.feedback&&(0,i.pn4)(o.feedback,d.data)))return[3,2];return[4,this.openFeedback(o.feedback,d.data)];case 1:t.sent(),t.label=2;case 2:return(e=o.redirect&&(0,i.hXT)(o.redirect,d.data))&&h.jumpTo(e,o,d.data),o.reload&&this.reloadTarget((0,i.u22)(o.reload,d.data),d.data),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),[2]}})})}).catch(function(e){if(a||o.countDown)throw e})];case 17:if(!c)return[3,19];return[4,c(e,(0,n.pi)((0,n.pi)({},o),{close:!1}),t,a,r||this.context)];case 18:b.sent(),o.close&&(!0===o.close?this.handleSelfClose():this.closeTarget(o.close)),b.label=19;case 19:return[2]}})})},o.prototype.handleChildFinished=function(e,o){if((!o||o.from!==this.$$id)&&!1!==o.close){var t=this.context.getComponents().filter(function(e){return!~["drawer","dialog","action","button","submit","reset"].indexOf(e.props.type)}),n=this.props.onConfirm,a=this.props.onClose;1===t.length&&("form"===t[0].props.type||"wizard"===t[0].props.type)&&(!0===o.close||!1!==t[0].props.closeDialogOnSubmit)?n&&n([e],o,{},t):!0===o.close&&a()}},o.prototype.handleDialogConfirm=function(o,t){for(var a,i,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];e.prototype.handleDialogConfirm.apply(this,(0,n.ev)([o,t],(0,n.CR)(r),!1));var l=this.props.store,c=l.getDialogScoped()||this.context,d=l.action,p=null!=(a=t.reload)?a:d.reload;p?c.reload(p,l.data):c.component!==this&&(null==(i=c.component)?void 0:i.reload)?c.component.reload():this.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},o.prototype.handleDrawerConfirm=function(o,t){for(var n,a=this,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];e.prototype.handleDrawerConfirm.call(this,o,t);var s=this.props.store,l=s.getDialogScoped()||this.context,c=s.action,d=null!=(n=t.reload)?n:c.reload;setTimeout(function(){var e;d?l.reload(d,s.data):l.component!==a&&(null==(e=l.component)?void 0:e.reload)?l.component.reload():a.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},300)},o.prototype.reloadTarget=function(e,o){this.context.reload(e,o)},o.prototype.closeTarget=function(e){this.context.close(e)},o.prototype.setData=function(e,o){return this.props.store.updateData(e,void 0,o)},o.prototype.getData=function(){return this.props.store.data},o.contextType=i.ZHe,o=(0,n.gn)([(0,i.Thl)({type:"dialog",storeType:i.vqG.name,storeExtendsData:!1,isolateScope:!0,shouldSyncSuperStore:function(e,o,t){return!!((e.dialogOpen||o.show)&&(o.show!==t.show||(0,i.RjM)(t.data,o.data)))}}),(0,n.w6)("design:paramtypes",[Object,Object])],o)}(d)}}]);