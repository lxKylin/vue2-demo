"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["2222"],{62795:function(e,t,n){n.r(t),n.d(t,{ExcelControlRenderer:()=>m,default:()=>v});var r=n(9787),i=n(65758),a=n(52027),o=n(59245),l=n.n(o),s=n(67929),u=n.n(s),c=n(82691),p=n.n(c),h=n(69143),d=n.n(h),f=n(47755),v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={filename:""},t}return(0,r.ZT)(t,e),t.prototype.componentDidUpdate=function(e){e.value===this.props.value||this.props.value||this.setState({filename:""})},t.prototype.syncAutoFill=function(e){var t=this.props,n=t.autoFill,r=t.onBulkChange,i=t.data,a=t.name;if((null==n||!n.hasOwnProperty("api"))&&(0,f.Kn2)(n)){var o=a?l()(n,a):n;if(!p()(o)&&r){var s=(0,f.buJ)(o,{filename:e});Object.keys(s).forEach(function(e){d()(s[e])&&d()(i[e])&&(s[e]=u()({},i[e],s[e]))}),r(s)}}},t.prototype.handleDrop=function(e){var t=this,i=e[0],a=i.name,o=new FileReader;o.readAsArrayBuffer(i),o.onload=function(){return(0,r.mG)(t,void 0,void 0,function(){var e=this;return(0,r.Jh)(this,function(t){return o.result&&(a.toLowerCase().endsWith(".xls")?n.e("9813").then(n.bind(n,60233)).then(function(t){var n=t.read(new Uint8Array(o.result),{cellDates:!0}),r=t.writeXLSX(n,{type:"array"});e.processExcelFile(r,a)}):this.processExcelFile(o.result,a)),[2]})})}},t.prototype.processExcelFile=function(e,t){var i=this,a=this.props,o=a.allSheets,l=a.onChange,s=a.parseImage,u=a.autoFill;n.e("7713").then(n.t.bind(n,36740,23)).then(function(n){return(0,r.mG)(i,void 0,void 0,function(){var i,a,c,p,h,d,f=this;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return i=n.default||n,this.ExcelJS=i,[4,(a=new i.Workbook).xlsx.load(e)];case 1:return r.sent(),c=[],o?a.eachSheet(function(e){"hidden"!==(e.state||"visible")&&(s?c.push({sheetName:e.name,data:f.readWorksheet(e),images:f.readImages(e,a)}):c.push({sheetName:e.name,data:f.readWorksheet(e)}))}):(p=a.worksheets.find(function(e){return"hidden"!==e.state}),s?(h=this.readImages(p,a),c={data:this.readWorksheet(p),images:h}):c=this.readWorksheet(p)),[4,this.dispatchEvent("change",c)];case 2:if(null==(d=r.sent())?void 0:d.prevented)return[2];return l(c),u&&this.syncAutoFill(t),this.setState({filename:t}),[2]}})})})},t.prototype.readImages=function(e,t){var n,i,a=this.props.imageDataURI,o=e.getImages(),l=[];try{for(var s=(0,r.XA)(o),u=s.next();!u.done;u=s.next()){var c=u.value,p=t.getImage(+c.imageId),h=this.encodeBase64Bytes(p.buffer);if(a){var d=p.extension||"png";l.push("data:image/".concat(d,";base64,")+h)}else l.push(h)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return l},t.prototype.encodeBase64Bytes=function(e){return btoa(e.reduce(function(e,t){return e+String.fromCharCode(t)},""))},t.prototype.dispatchEvent=function(e,t){return(0,r.mG)(this,void 0,void 0,function(){var n,i;return(0,r.Jh)(this,function(r){switch(r.label){case 0:return i=(n=this.props).dispatchEvent,n.data,[4,i(e,(0,f.vXk)(this.props,{value:t}))];case 1:return[2,r.sent()]}})})},t.prototype.isRichTextValue=function(e){return!!(e&&(0,f.Kn2)(e)&&e.hasOwnProperty("richText")&&Array.isArray(null==e?void 0:e.richText))},t.prototype.richText2PlainString=function(e,t){return void 0===t&&(t=!1),e.richText.map(function(e){var n=e.text,r=e.font,i=void 0===r?{}:r,a=n;if(t){var o="",l=(null==i?void 0:i.bold)?"strong":(null==i?void 0:i.italic)?"em":(null==i?void 0:i.vertAlign)==="superscript"?"sup":(null==i?void 0:i.vertAlign)==="subscript"?"sub":"span";(null==i?void 0:i.strike)?o+="text-decoration: line-through;":(null==i?void 0:i.underline)&&(o+="text-decoration: underline;"),(null==i?void 0:i.outline)&&(o+="outline: solid;"),(null==i?void 0:i.size)&&(o+="font-size: ".concat(i.size,"px;")),a="<".concat(l," ").concat(o?"style=".concat(o):"",">").concat(n,"</").concat(l,">")}return a}).join("")},t.prototype.readWorksheet=function(e){var t=this,n=[],r=this.props,i=r.parseMode,a=r.plainText,o=r.includeEmpty;if("array"===i)return e.eachRow(function(e,r){var i=e.values;i.shift(),a&&(i=i.map(function(e){if(e instanceof Object){if(e.hyperlink)return e.hyperlink.startsWith("mailto:")?e.hyperlink.substring(7):e.hyperlink;else if(e.result)return e.result;else if(e.richText)return t.richText2PlainString(e)}return e})),n.push(i)}),n;var l=[];return e.eachRow(function(e,r){var i;if(1==r)l=(null!=(i=e.values)?i:[]).map(function(e){return t.isRichTextValue(e)?t.richText2PlainString(e):e});else{var s={};o&&l.forEach(function(e){s[e]=""}),e.eachCell(function(e,n){if(l[n]){var r=e.value;if(a){var i=t.ExcelJS.ValueType;e.type===i.Hyperlink?(r=e.value.hyperlink).startsWith("mailto:")&&(r=r.substring(7)):e.type===i.Formula?r=e.value.result:e.type===i.RichText?r=t.richText2PlainString(e.value):e.type===i.Error&&(r="")}s[l[n]]=r}}),n.push(s)}}),n},t.prototype.doAction=function(e,t,n){var r,i,a=null==e?void 0:e.actionType,o=this.props,l=o.onChange,s=o.resetValue,u=o.formStore,c=o.store,p=o.name;if("clear"===a)l("");else if("reset"===a){var h=null!=(i=(0,f.E04)(null!=(r=null==u?void 0:u.pristine)?r:null==c?void 0:c.pristine,p))?i:s;l(null!=h?h:"")}},t.prototype.render=function(){var e=this,t=this.props,n=t.className,o=t.classnames,l=(t.classPrefix,t.disabled),s=t.translate,u=t.placeholder,c=t.testIdBuilder;return i.createElement("div",{className:o("ExcelControl",n)},i.createElement(a.ZP,{key:"drop-zone",onDrop:this.handleDrop,accept:".xlsx,.xls",multiple:!1,disabled:l},function(t){var a=t.getRootProps,l=t.getInputProps;return i.createElement("section",{className:o("ExcelControl-container",n)},i.createElement("div",(0,r.pi)({},a({className:o("ExcelControl-dropzone")}),null==c?void 0:c.getTestId()),i.createElement("input",(0,r.pi)({},l(),null==c?void 0:c.getChild("input").getTestId())),e.state.filename?s("Excel.parsed",{filename:e.state.filename}):i.createElement("p",null,null!=u?u:s("Excel.placeholder"))))}))},t.defaultProps={allSheets:!1,parseMode:"object",includeEmpty:!0,plainText:!0,parseImage:!1,imageDataURI:!0},(0,r.gn)([f.NjZ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[String]),(0,r.w6)("design:returntype",void 0)],t.prototype,"syncAutoFill",null),(0,r.gn)([f.NjZ,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",[Array]),(0,r.w6)("design:returntype",void 0)],t.prototype,"handleDrop",null),t}(i.PureComponent),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,r.ZT)(t,e),t=(0,r.gn)([(0,f.xJW)({type:"input-excel"})],t)}(v)}}]);