"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["8653"],{89952:function(e,t,r){r.r(t),r.d(t,{CardsRenderer:()=>u,default:()=>p});var n=r(9787),a=r(65758),o=r(97326),i=r(47755),s=r(68333),l=r(65861),d=r(33170),c=r.n(d),p=function(e){function t(r){var n=e.call(this,r)||this;n.handleAction=n.handleAction.bind(n),n.handleCheck=n.handleCheck.bind(n),n.handleClick=n.handleClick.bind(n),n.handleCheckAll=n.handleCheckAll.bind(n),n.handleQuickChange=n.handleQuickChange.bind(n),n.handleSave=n.handleSave.bind(n),n.handleSaveOrder=n.handleSaveOrder.bind(n),n.reset=n.reset.bind(n),n.dragTipRef=n.dragTipRef.bind(n),n.bodyRef=n.bodyRef.bind(n),n.renderToolbar=n.renderToolbar.bind(n);var a=r.store,o=r.selectable,i=r.draggable,s=r.orderBy,l=r.orderDir,d=r.multiple,c=r.hideCheckToggler,p=r.itemCheckableOn,u=r.itemDraggableOn;return a.update({selectable:o,draggable:i,orderBy:s,orderDir:l,multiple:d,hideCheckToggler:c,itemCheckableOn:p,itemDraggableOn:u}),t.syncItems(a,n.props)&&n.syncSelected(),n}return(0,n.ZT)(t,e),t.syncItems=function(e,t,r){var n=t.source,a=(0,i.v8S)(t,function(e){return e.items}),o=[],s=!1;if(Array.isArray(a)&&(!r||(0,i.v8S)(r,function(e){return e.items})!==a))o=a,s=!0;else if("string"==typeof n){var l=(0,i.OgC)(n,t.data,"| raw");(r?(0,i.OgC)(n,r.data,"| raw"):null)===l?s=!1:(o=Array.isArray(l)?l:[],s=!0)}return s&&e.initItems(o,t.fullItems,t.selected),Array.isArray(t.selected)&&e.updateSelected(t.selected,t.valueField),s},t.prototype.componentDidUpdate=function(e){var r=this.props,n=r.store;(0,i.aGv)(["selectable","draggable","orderBy","orderDir","multiple","hideCheckToggler","itemCheckableOn","itemDraggableOn"],e,r)&&n.update({selectable:r.selectable,draggable:r.draggable,orderBy:r.orderBy,orderDir:r.orderDir,multiple:r.multiple,hideCheckToggler:r.hideCheckToggler,itemCheckableOn:r.itemCheckableOn,itemDraggableOn:r.itemDraggableOn}),(0,i.aGv)(["source","value","items"],e,r)||!r.value&&!r.items&&(r.data!==e.data||"string"==typeof r.source&&(0,i.SSQ)(r.source))?t.syncItems(n,r,e)&&this.syncSelected():e.selected!==r.selected&&n.updateSelected(r.selected||[],r.valueField)},t.prototype.bodyRef=function(e){this.body=e},t.prototype.handleAction=function(e,t,r){(0,this.props.onAction)(e,t,r)},t.prototype.handleCheck=function(e){e.toggle(),this.syncSelected();var t=this.props,r=t.store;(0,t.dispatchEvent)("selectedChange",(0,i.nW9)(r.data,(0,n.pi)((0,n.pi)({},r.eventContext),{item:e.data})))},t.prototype.handleClick=function(e){var t=this.props,r=t.dispatchEvent,n=t.data;return r("rowClick",(0,i.nW9)(n,{item:e.data,index:e.index}))},t.prototype.handleCheckAll=function(){this.props.store.toggleAll(),this.syncSelected()},t.prototype.handleSelectAll=function(){this.props.store.selectAll(),this.syncSelected()},t.prototype.handleClearAll=function(){this.props.store.clearAll(),this.syncSelected()},t.prototype.syncSelected=function(){var e=this.props,t=e.store,r=e.onSelect,n=e.dispatchEvent,a=t.selectedItems.map(function(e){return e.data}),o=t.unSelectedItems.map(function(e){return e.data});n("selected",(0,i.nW9)(t.data,{selectItems:a,unSelectItems:o})),r&&r(a,o)},t.prototype.handleQuickChange=function(e,t,r,n,a){e.change(t,n);var o=this.props,s=o.onSave,l=o.onItemChange,d=o.primaryField;if(!n){if(null==l||l(e.data,(0,i.e50)(e.data,e.pristine,["id",d]),e.index),r&&r.api)return void this.props.onAction(null,{actionType:"ajax",api:r.api,reload:null==a?void 0:a.reload},e.locals);r&&s&&s(e.data,(0,i.e50)(e.data,e.pristine,["id",d]),e.index,void 0,e.pristine,a)}},t.prototype.handleSave=function(){var e=this.props,t=e.store,r=e.onSave,n=e.primaryField;if(r&&t.modifiedItems.length){var a=t.modifiedItems.map(function(e){return e.data}),o=t.modifiedItems.map(function(e){return e.index});r(a,t.modifiedItems.map(function(e){return(0,i.e50)(e.data,e.pristine,["id",n])}),o,t.items.filter(function(e){return!e.modified}).map(function(e){return e.data}),t.modifiedItems.map(function(e){return e.pristine}))}},t.prototype.handleSaveOrder=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,r,a,o,s,l;return(0,n.Jh)(this,function(n){switch(n.label){case 0:return t=(e=this.props).store,r=e.onSaveOrder,a=e.data,o=e.dispatchEvent,s=t.movedItems.map(function(e){return e.data}),[4,o("orderChange",(0,i.nW9)(a,{movedItems:s}))];case 1:if((null==(l=n.sent())?void 0:l.prevented)||!r||!t.movedItems.length)return[2];return r(t.movedItems.map(function(e){return e.data}),t.items.map(function(e){return e.data})),[2]}})})},t.prototype.reset=function(){this.props.store.reset()},t.prototype.bulkUpdate=function(e,t){var r=this.props,a=r.store,o=r.primaryField;if(o&&e.ids){var i=e.ids.split(","),s=a.items.filter(function(e){return c()(i,function(t){return t&&t==e.data[o]})}),l=(0,n.pi)((0,n.pi)({},e),{ids:void 0});s.forEach(function(e){return e.change(l)})}else if(Array.isArray(t)){var s=a.items.filter(function(e){return~t.indexOf(e.pristine)});s.forEach(function(t){return t.change(e)})}},t.prototype.getSelected=function(){return this.props.store.selectedItems.map(function(e){return e.data})},t.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},t.prototype.initDragging=function(){if(!this.sortable){var e=this.props.store,t=(0,o.findDOMNode)(this),r=this.props.classPrefix;this.sortable=new l.ZP(t.querySelector(".".concat(r,"Cards-body")),{group:"table",animation:150,handle:".".concat(r,"Card-dragBtn"),ghostClass:"is-dragging",onEnd:function(t){if(t.newIndex!==t.oldIndex){var r=t.to;t.oldIndex<r.childNodes.length-1?r.insertBefore(t.item,r.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):r.appendChild(t.item),e.exchange(t.oldIndex,t.newIndex)}}})}},t.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy(),this.sortable=void 0},t.prototype.renderActions=function(e){var t,r=this,o=this.props,i=o.actions,s=o.render,l=o.store,d=o.classnames;return i=Array.isArray(i)?i.concat():[],!~this.renderedToolbars.indexOf("check-all")&&(t=this.renderCheckAll())&&i.unshift({type:"button",children:t}),"header"===e&&!~this.renderedToolbars.indexOf("drag-toggler")&&(t=this.renderDragToggler())&&i.unshift({type:"button",children:t}),Array.isArray(i)&&i.length?a.createElement("div",{className:d("Cards-actions")},i.map(function(e,t){return s("action/".concat(t),(0,n.pi)({type:"button"},e),{onAction:r.handleAction,key:t,btnDisabled:l.dragging})})):null},t.prototype.renderHeading=function(){var e=this.props,t=e.title,r=e.store,n=e.hideQuickSaveBtn,o=e.classnames,l=e.data;return t||r.modified&&!n||r.moved?a.createElement("div",{className:o("Cards-heading")},r.modified&&!n?a.createElement("span",null,"当前有 ".concat(r.modified," 条记录修改了内容, 但并没有提交。请选择:"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--success m-l-sm"),onClick:this.handleSave},a.createElement(s.JO,{icon:"check",className:"icon m-r-xs"}),"提交"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},a.createElement(s.JO,{icon:"close",className:"icon m-r-xs"}),"放弃")):r.moved?a.createElement("span",null,"当前有 ".concat(r.moved," 条记录修改了顺序, 但并没有提交。请选择:"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--success m-l-sm"),onClick:this.handleSaveOrder},a.createElement(s.JO,{icon:"check",className:"icon m-r-xs"}),"提交"),a.createElement("button",{type:"button",className:o("Button Button--xs Button--danger m-l-sm"),onClick:this.reset},a.createElement(s.JO,{icon:"close",className:"icon m-r-xs"}),"放弃")):t?(0,i.hXT)(t,l):""):null},t.prototype.renderHeader=function(){var e=this.props,t=e.header,r=e.headerClassName,o=(e.headerToolbar,e.headerToolbarRender),i=e.showHeader,s=e.render,l=e.store,d=e.classnames,c=e.translate;if(!1===i)return null;var p=o?o((0,n.pi)((0,n.pi)({},this.props),l.eventContext),this.renderToolbar):null,u=this.renderActions("header"),h=u||p||l.dragging?a.createElement("div",{className:d("Cards-toolbar"),key:"header-toolbar"},u,p,l.dragging?a.createElement("div",{className:d("Cards-dragTip"),ref:this.dragTipRef},c("Card.dragTip")):null):null,m=t?a.createElement("div",{className:d("Cards-header",r),key:"header"},s("header",t)):null;return m&&h?[m,h]:m||h||null},t.prototype.renderFooter=function(){var e=this.props,t=e.footer,r=e.footerClassName,o=(e.footerToolbar,e.footerToolbarRender),i=e.render,s=e.showFooter,l=e.store,d=e.classnames,c=e.affixFooter;if(!1===s)return null;var p=o?o((0,n.pi)((0,n.pi)({},this.props),l.eventContext),this.renderToolbar):null,u=this.renderActions("footer"),h=t?a.createElement("div",{className:d("Cards-footer",r,c?"Cards-footer--affix":""),key:"footer"},i("footer",t)):null,m=u||p?a.createElement("div",{className:d("Cards-toolbar",!h&&c?"Cards-footToolbar--affix":""),key:"footer-toolbar"},u,p):null;return h&&m?[m,h]:h||m||null},t.prototype.renderCheckAll=function(){var e=this.props,t=e.store,r=e.multiple,n=e.selectable,o=e.checkAll;return t.selectable&&r&&n&&!t.dragging&&t.items.length&&o?a.createElement(s.zx,{key:"checkall",tooltip:"切换全选",onClick:this.handleCheckAll,size:"sm",level:t.allChecked?"info":"default"},"全选"):null},t.prototype.renderDragToggler=function(){var e=this,t=this.props,r=t.store,n=(t.multiple,t.selectable,t.popOverContainer),o=t.env,i=t.translate,l=t.dragIcon;return!r.draggable||r.items.length<2?null:a.createElement(s.zx,{iconOnly:!0,key:"dragging-toggle",tooltip:i("Card.toggleDrag"),tooltipContainer:n||(null==o?void 0:o.getModalContainer),size:"sm",active:r.dragging,onClick:function(t){t.preventDefault(),r.toggleDragging(),r.dragging&&r.clear(),r.dragging&&e.initDragging()}},a.isValidElement(l)?l:a.createElement(s.JO,{icon:"exchange",className:"icon r90"}))},t.prototype.renderToolbar=function(e,t){var r=e.type||e;return"drag-toggler"===r?(this.renderedToolbars.push(r),this.renderDragToggler()):"check-all"===r?(this.renderedToolbars.push(r),this.renderCheckAll()):void 0},t.prototype.renderCard=function(e,t,r,o,s){var l=this,d=this.props,c=d.render,p=d.classnames,u=d.store,h=d.multiple,m=d.checkOnItemClick,g=d.hideCheckToggler,f={className:p((0,i.Hxu)(t&&t.className||"",r.locals),{"is-checked":r.checked,"is-modified":r.modified,"is-moved":r.moved,"is-dragging":u.dragging}),item:r,key:e,itemIndex:r.index,multiple:h,selectable:u.selectable,checkable:r.checkable,draggable:r.draggable,selected:r.checked,dragging:u.dragging,data:r.locals,onAction:this.handleAction,onCheck:this.handleCheck,onClick:this.handleClick,onQuickChange:u.dragging?null:this.handleQuickChange};return(null==t?void 0:t.type)==="card2"&&(f=(0,n.pi)((0,n.pi)({},f),{item:r.locals,onCheck:function(){l.handleCheck(r)}})),a.createElement("div",{key:r.index,className:p(o),style:s},c("card/".concat(e),(0,n.pi)({type:t.type||"card",hideCheckToggler:g,checkOnItemClick:m},t),f))},t.prototype.render=function(){var e=this,t=this.props,r=t.className,o=t.style,l=t.store,d=t.columnsCount,c=t.itemClassName,p=t.placeholder,u=t.card,h=t.data,m=t.render,g=t.affixHeader,f=t.masonryLayout,v=t.itemsClassName,y=t.classnames,C=t.translate,b=t.loading,k=t.loadingConfig,x=t.env,T=t.id,A=t.wrapperCustomStyle,N=t.themeCss,E=t.mobileUI;this.renderedToolbars=[];var S=d?"Grid-col--sm".concat(Math.round(12/d)):c||"",D=this.renderHeader(),I=this.renderHeading(),O=this.renderFooter(),w="";f&&(w="Cards--masonry "+S.split(/\s/).map(function(e){return/^Grid-col--(xs|sm|md|lg)(\d+)/.test(e)?"Cards--masonry".concat((0,i.zfV)(RegExp.$1)).concat(RegExp.$2):e}).join(" "));var B={},R={};return(null==o?void 0:o.gutterX)>=0&&(B.marginLeft=B.marginRight=-((null==o?void 0:o.gutterX)/2)+"px",R.paddingLeft=R.paddingRight=(null==o?void 0:o.gutterX)/2+"px"),(null==o?void 0:o.gutterY)>=0&&(R.marginBottom=(null==o?void 0:o.gutterY)+"px"),!d||f||E||(R.flex="0 0 ".concat(100/d,"%"),R.maxWidth="".concat(100/d,"%")),a.createElement("div",{ref:this.bodyRef,className:y("Cards",r,{"Cards--unsaved":!!l.modified||!!l.moved},(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"baseControlClassName",id:T,themeCss:N})),(0,i.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"wrapperCustomStyle",id:T,themeCss:A}))),style:(0,i.uBL)(o,h)},g?a.createElement("div",{className:y("Cards-fixedTop")},D,I):a.createElement(a.Fragment,null,D,I),l.items.length?a.createElement("div",{className:y("Cards-body Grid",v,w),style:B},l.items.map(function(t,r){return e.renderCard(r,u,t,S,R)})):a.createElement("div",{className:y("Cards-placeholder")},m("placeholder",C(p))),O,a.createElement(s.$j,{loadingConfig:k,overlay:!0,show:void 0!==b&&b}),a.createElement(i.cWM,(0,n.pi)({},this.props,{config:{wrapperCustomStyle:A,id:T,themeCss:N,classNames:[{key:"baseControlClassName"}]},env:x})))},t.propsList=["header","headerToolbarRender","footer","footerToolbarRender","placeholder","source","selectable","headerClassName","footerClassName","hideQuickSaveBtn","hideCheckToggler","itemCheckableOn","itemDraggableOn","masonryLayout","items","valueField"],t.defaultProps={className:"",placeholder:"placeholder.noData",source:"$items",selectable:!1,headerClassName:"",footerClassName:"",itemClassName:"Grid-col--sm6 Grid-col--md4 Grid-col--lg3",hideCheckToggler:!1,masonryLayout:!1,affixHeader:!0,itemsClassName:"",checkAll:!0},t}(a.Component),u=function(e){function t(t,r){var n=e.call(this,t)||this;return r.registerComponent(n),n}return(0,n.ZT)(t,e),t.prototype.componentWillUnmount=function(){var t;null==(t=e.prototype.componentWillUnmount)||t.call(this),this.context.unRegisterComponent(this)},t.prototype.receive=function(e,t){var r,n,a,o,i=this.context;return(null==(r=null==i?void 0:i.parent)||r.getComponents(),null==(n=this.props)?void 0:n.host)?null==(o=(a=this.props.host).receive)?void 0:o.call(a,e,t):t?i.send(t,e):void 0},t.prototype.reload=function(e,t,r,a,o,i){var s,l,d;return(0,n.mG)(this,void 0,void 0,function(){var a;return(0,n.Jh)(this,function(n){return(this.props.store,(null==i?void 0:i.index)||(null==i?void 0:i.condition))?[2]:(a=this.context,null==(s=this.props)?void 0:s.host)?[2,null==(d=(l=this.props.host).reload)?void 0:d.call(l,e,t,r)]:e?[2,a.reload(e,r)]:[2]})})},t.prototype.setData=function(e,t,r,a){var o,s,l;return(0,n.mG)(this,void 0,void 0,function(){var d;return(0,n.Jh)(this,function(n){switch(n.label){case 0:if(d=this.props.store,void 0===r&&void 0===a)return[3,2];return[4,(0,i.tW8)(d.items,this.props.data,r,a)];case 1:return n.sent().forEach(function(t){t.updateData(e)}),[3,3];case 2:if(null==(o=this.props)?void 0:o.host)return[2,null==(l=(s=this.props.host).setData)?void 0:l.call(s,e,t,r,a)];return[2,d.updateData(e,void 0,t)];case 3:return[2]}})})},t.prototype.getData=function(){var e=this.props,t=e.store,r=e.data;return t.getData(r)},t.prototype.hasModifiedItems=function(){return this.props.store.modified},t.prototype.doAction=function(e,t,r,a){return(0,n.mG)(this,void 0,void 0,function(){var r,o,s,l,d;return(0,n.Jh)(this,function(n){switch(n.label){case 0:switch(o=(r=this.props).store,s=r.valueField,l=r.data,null==e?void 0:e.actionType){case"selectAll":return[3,1];case"clearAll":return[3,2];case"select":return[3,3];case"initDrag":return[3,5];case"cancelDrag":return[3,6];case"submitQuickEdit":return[3,7]}return[3,9];case 1:return o.clear(),o.toggleAll(),this.syncSelected(),[3,10];case 2:return o.clear(),this.syncSelected(),[3,10];case 3:return[4,(0,i.tW8)(o.items,t||this.props.data,a.index,a.condition,a.selected)];case 4:return d=n.sent(),o.updateSelected(d.map(function(e){return e.data}),s),this.syncSelected(),[3,10];case 5:return o.startDragging(),[3,10];case 6:return o.stopDragging(),[3,10];case 7:return[4,this.handleSave()];case 8:return n.sent(),[3,10];case 9:return[2,this.handleAction(void 0,e,l)];case 10:return[2]}})})},t.contextType=i.ZHe,t=(0,n.gn)([(0,i.Thl)({name:"cards",type:"cards",storeType:i.oPK.name,weight:-100}),(0,n.w6)("design:paramtypes",[Object,Object])],t)}(p)}}]);