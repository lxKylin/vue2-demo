"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["5095"],{56611:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Chart:()=>Chart,ChartRenderer:()=>ChartRenderer});var tslib__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9787),react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(65758),amis_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(47755),classnames__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84875),classnames__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(classnames__WEBPACK_IMPORTED_MODULE_2__),mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6663),lodash_debounce__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(66292),lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_debounce__WEBPACK_IMPORTED_MODULE_3__),lodash_pick__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(19334),lodash_pick__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(lodash_pick__WEBPACK_IMPORTED_MODULE_4__),lodash_isString__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(56549),lodash_isString__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(lodash_isString__WEBPACK_IMPORTED_MODULE_5__),DEFAULT_EVENT_PARAMS=["componentType","seriesType","seriesIndex","seriesName","name","dataIndex","data","dataType","value","color"],EVAL_CACHE={};function recoverFunctionType(config){["interval","formatter","color","min","max","labelFormatter","valueFormatter","pageFormatter","optionToContent","contentToOption","animationDelay","animationDurationUpdate","animationDelayUpdate","animationDuration","position","sort","renderItem"].forEach(function(key){var e_1,_a,objects=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.jbC)(config,key);try{for(var objects_1=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.XA)(objects),objects_1_1=objects_1.next();!objects_1_1.done;objects_1_1=objects_1.next()){var object=objects_1_1.value,code=object[key];if("string"==typeof code&&code.trim().startsWith("function"))try{code in EVAL_CACHE||(EVAL_CACHE[code]=eval("("+code+")")),object[key]=EVAL_CACHE[code]}catch(e){console.warn(code,e)}}}catch(e_1_1){e_1={error:e_1_1}}finally{try{objects_1_1&&!objects_1_1.done&&(_a=objects_1.return)&&_a.call(objects_1)}finally{if(e_1)throw e_1.error}}})}var Chart=function(t){function e(e){var r=t.call(this,e)||this;return r.refFn=r.refFn.bind(r),r.reload=r.reload.bind(r),r.reloadEcharts=lodash_debounce__WEBPACK_IMPORTED_MODULE_3___default()(r.reloadEcharts.bind(r),300),r.handleClick=r.handleClick.bind(r),r.dispatchEvent=r.dispatchEvent.bind(r),r.loadChartMapData=r.loadChartMapData.bind(r),r.mounted=!0,e.config&&r.renderChart(e.config),r}return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.ZT)(e,t),e.prototype.componentDidMount=function(){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var t,e,r,n,a,i,s;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(o){switch(o.label){case 0:return e=(t=this.props).api,r=t.data,n=t.initFetch,a=t.source,[4,(0,t.dispatchEvent)("init",r,this)];case 1:if(null==(i=o.sent())?void 0:i.prevented)return[2];return a&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(a)?(s=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(a,r,"| raw"))&&this.renderChart(s):e&&!1!==n&&this.reload(),[2]}})})},e.prototype.componentDidUpdate=function(t){var e=this,r=this.props;if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.rMT)(t.api,r.api,t.data,r.data))this.reload();else if(r.source&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(r.source)){var n=t.source?(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(t.source,t.data,"| raw"):null,a=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(r.source,r.data,"| raw");n!==a&&this.renderChart(a||{})}else if(r.config!==t.config)this.renderChart(r.config||{});else if(r.config&&r.trackExpression&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.hXT)(r.trackExpression,r.data)!==(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.hXT)(t.trackExpression,t.data))this.renderChart(r.config||{});else if((0,amis_core__WEBPACK_IMPORTED_MODULE_1__.rMT)(t.mapURL,r.mapURL,t.data,r.data)){var i=r.source,s=r.data,o=r.api,h=r.config;this.loadChartMapData(function(){if(i&&(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(i)){var t=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(i,s,"| raw");t&&e.renderChart(t)}else o?e.reload():h&&e.renderChart(h||{})})}},e.prototype.componentWillUnmount=function(){this.mounted=!1,this.reloadEcharts.cancel(),clearTimeout(this.timer)},e.prototype.loadChartMapData=function(t){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var e,r,n,a,i,s,o;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(h){switch(h.label){case 0:if(r=(e=this.props).env,n=e.data,i=(a=this.props).mapName,!((s=a.mapURL)&&i&&window.echarts))return[3,2];return(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.SSQ)(i)&&(i=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.OgC)(i,n)),[4,r.fetcher(s,n)];case 1:(o=h.sent()).ok||console.warn("fetch map geo error "+s),window.echarts.registerMap(i,o.data),h.label=2;case 2:return t&&t(),[2]}})})},e.prototype.handleClick=function(t){return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var e,r,n,a,i;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(s){switch(s.label){case 0:return r=(e=this.props).onAction,n=e.clickAction,a=e.data,[4,(0,e.dispatchEvent)(t.event,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(a,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(t,DEFAULT_EVENT_PARAMS))))];case 1:if(null==(i=s.sent())?void 0:i.prevented)return[2];return n&&r&&r(null,n,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(a,t)),[2]}})})},e.prototype.dispatchEvent=function(t){var e=this.props,r=e.data;(0,e.dispatchEvent)(t.event||t.type,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(r,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},lodash_pick__WEBPACK_IMPORTED_MODULE_4___default()(t,"legendselectchanged"===t.type?["name","selected"]:DEFAULT_EVENT_PARAMS))))},e.prototype.refFn=function(t){var e=this,r=this.props.chartRef,n=this.props,a=n.chartTheme,i=n.onChartWillMount,s=n.onChartUnMount,o=n.env,h=n.loadBaiduMap;n.data;var c=this.props,l=c.mapURL,p=c.mapName,d=this.props.onChartMount||this.onChartMount;t?Promise.all([Promise.all([__webpack_require__.e("2126"),__webpack_require__.e("6731")]).then(__webpack_require__.bind(__webpack_require__,90133)),__webpack_require__.e("8259").then(__webpack_require__.t.bind(__webpack_require__,87160,23)),Promise.all([__webpack_require__.e("2126"),__webpack_require__.e("6731"),__webpack_require__.e("7977")]).then(__webpack_require__.bind(__webpack_require__,17212)),Promise.all([__webpack_require__.e("2126"),__webpack_require__.e("6731"),__webpack_require__.e("5087")]).then(__webpack_require__.bind(__webpack_require__,6827)),__webpack_require__.e("5746").then(__webpack_require__.t.bind(__webpack_require__,46021,23))]).then(function(n){var s=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.CR)(n,2),c=s[0],u=s[1];return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(e,void 0,void 0,function(){var e,n=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(s){switch(s.label){case 0:if(window.echarts=c,window.ecStat=(null==u?void 0:u.default)||u,!(l&&p))return[3,2];return[4,this.loadChartMapData()];case 1:s.sent(),s.label=2;case 2:if(!h)return[3,4];return[4,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.veE)("//api.map.baidu.com/api?v=3.0&ak=".concat(this.props.ak,"&callback={{callback}}"))];case 3:s.sent(),s.label=4;case 4:if(e="default",a&&(c.registerTheme("custom",a),e="custom"),!i)return[3,6];return[4,i(c)];case 5:s.sent(),s.label=6;case 6:if(u.transform&&(c.registerTransform(u.transform.regression),c.registerTransform(u.transform.histogram),c.registerTransform(u.transform.clustering)),!o.loadChartExtends)return[3,8];return[4,o.loadChartExtends()];case 7:s.sent(),s.label=8;case 8:return this.echarts=c.init(t,e),"string"==typeof d&&(d=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.PqP)(d,"chart","echarts")),null==d||d(this.echarts,c),this.echarts.on("click",this.handleClick),this.echarts.on("mouseover",this.dispatchEvent),this.echarts.on("legendselectchanged",this.dispatchEvent),this.unSensor=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Adl)(t,function(){var e,r=t.offsetWidth,a=t.offsetHeight;null==(e=n.echarts)||e.resize({width:r,height:a})}),r&&r(this.echarts),this.renderChart(),[2]}})})}):(r&&r(null),this.unSensor&&this.unSensor(),this.echarts&&(null==s||s(this.echarts,window.echarts),this.echarts.dispose(),delete this.echarts)),this.ref=t},e.prototype.doAction=function(t,e,r){var n,a;return void 0===r&&(r=!1),null==(a=null==(n=this.echarts)?void 0:n.dispatchAction)?void 0:a.call(n,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({type:t.actionType},e))},e.prototype.reload=function(t,e,r,n,a){var i,s,o,h,c,l;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.mG)(this,void 0,void 0,function(){var t,r,n,p,d,u,f,m,v,C,g=this;return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.Jh)(this,function(y){switch(y.label){case 0:if(r=(t=this.props).api,n=t.env,p=t.store,d=t.translate,e)return[2,this.receive(e,void 0,a)];if(!n||!n.fetcher||!(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.X1t)(r,p.data))return[2];clearTimeout(this.timer),this.reloadCancel&&(this.reloadCancel(),delete this.reloadCancel,null==(i=this.echarts)||i.hideLoading()),null==(s=this.echarts)||s.showLoading(),p.markFetching(!0),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,n.fetcher(r,p.data,{cancelExecutor:function(t){return g.reloadCancel=t}})];case 2:if(u=y.sent(),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(p)&&p.markFetching(!1),!u.ok)return(null==r?void 0:r.silent)||n.notify("error",null!=(h=null==(o=null==r?void 0:r.messages)?void 0:o.failed)?h:u.msg||d("fetchFailed"),void 0!==u.msgTimeout?{closeButton:!0,timeout:u.msgTimeout}:void 0),[2];return delete this.reloadCancel,!(f=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Mpd)(u.data)).series&&this.props.config?(m=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.nW9)(this.props.data,f),this.renderChart(this.props.config,m)):this.renderChart(u.data||{}),null==(c=this.echarts)||c.hideLoading(),(v=this.props.interval)&&lodash_isString__WEBPACK_IMPORTED_MODULE_5___default()(v)&&(v=Number.parseInt(v)),v&&this.mounted&&(this.timer=setTimeout(this.reload,Math.max(v,1e3))),[2,p.data];case 3:if(C=y.sent(),n.isCancel(C))return[2];return(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(p)&&p.markFetching(!1),(null==r?void 0:r.silent)||n.notify("error",C),null==(l=this.echarts)||l.hideLoading(),[3,4];case 4:return[2]}})})},e.prototype.receive=function(t,e,r){this.props.store.updateData(t,void 0,r),this.reload()},e.prototype.renderChart=function(t,e){if(t&&(this.pending=t),e&&(this.pendingCtx=e),this.echarts){var r,n,a=this.props.store,i=this.props.onDataFilter,s=this.props.dataFilter;i||"string"!=typeof s||(i=Function("config","echarts","data",s)),t=t||this.pending,e=e||this.pendingCtx||this.props.data,"string"==typeof t&&(t=Function("return "+t)());try{i&&(t=i(t,window.echarts,e)||t)}catch(t){console.warn(t)}if(t)try{this.props.disableDataMapping||(t=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.buJ)(t,e,function(t,e){return"function"==typeof e||"string"==typeof e&&e.startsWith("function")})),recoverFunctionType(t),(0,mobx_state_tree__WEBPACK_IMPORTED_MODULE_7__.fh)(a)&&a.loading?null==(r=this.echarts)||r.showLoading():null==(n=this.echarts)||n.hideLoading(),this.reloadEcharts(t)}catch(t){console.warn(t)}}},e.prototype.reloadEcharts=function(t){var e;null==(e=this.echarts)||e.setOption(t,this.props.replaceChartOption)},e.prototype.render=function(){var t=this,e=this.props,r=e.className,n=e.width,a=e.height,i=e.classPrefix,s=e.unMountOnHidden,o=e.data,h=e.id,c=e.wrapperCustomStyle,l=e.env,p=e.themeCss;e.baseControlClassName;var d=this.props.style||{};d.width=d.width||n||"100%",d.height=d.height||a||"300px";var u=(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.uBL)(d,o);return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:classnames__WEBPACK_IMPORTED_MODULE_2___default()("".concat(i,"Chart"),r,(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GwQ)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props),{name:"baseControlClassName",id:h,themeCss:p})),(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.GwQ)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)((0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props),{name:"wrapperCustomStyle",id:h,themeCss:c}))),style:u},react__WEBPACK_IMPORTED_MODULE_0__.createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.crj,{unMountOnHidden:s,placeholder:"...",component:function(){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"".concat(i,"Chart-content"),ref:t.refFn})}}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(amis_core__WEBPACK_IMPORTED_MODULE_1__.cWM,(0,tslib__WEBPACK_IMPORTED_MODULE_6__.pi)({},this.props,{config:{wrapperCustomStyle:c,id:h,themeCss:p,classNames:[{key:"baseControlClassName"}]},env:l})))},e.defaultProps={replaceChartOption:!1,unMountOnHidden:!1},e.propsList=[],e}(react__WEBPACK_IMPORTED_MODULE_0__.Component),ChartRenderer=function(t){function e(e,r){var n=t.call(this,e)||this;return r.registerComponent(n),n}return(0,tslib__WEBPACK_IMPORTED_MODULE_6__.ZT)(e,t),e.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount.call(this),this.context.unRegisterComponent(this)},e.prototype.setData=function(t,e){var r=this.props.store;r.updateData(t,void 0,e),this.renderChart(this.props.config,r.data)},e.prototype.getData=function(){return this.props.store.data},e.contextType=amis_core__WEBPACK_IMPORTED_MODULE_1__.ZHe,e=(0,tslib__WEBPACK_IMPORTED_MODULE_6__.gn)([(0,amis_core__WEBPACK_IMPORTED_MODULE_1__.Thl)({type:"chart",storeType:amis_core__WEBPACK_IMPORTED_MODULE_1__.Y5f.name}),(0,tslib__WEBPACK_IMPORTED_MODULE_6__.w6)("design:paramtypes",[Object,Object])],e)}(Chart)}}]);