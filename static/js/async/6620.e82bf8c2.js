"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["6620"],{87215:function(e,t,n){n.r(t),n.d(t,{PickerControlRenderer:()=>O,default:()=>N});var i=n(9787),o=n(65758),r=n(84875),s=n.n(r),a=n(59245),l=n.n(a),p=n(33170),c=n.n(p),u=n(31223),d=n.n(u),h=n(33886),m=n.n(h),v=n(67929),g=n.n(v),f=n(47755),y=n(68333),w=n(4295),C=n.n(w),k=n(81415),b=n(23293),N=function(e){function t(t){var n=e.call(this,t)||this;n.state={isOpened:!1,schema:n.buildSchema(n.props),isFocused:!1},n.input=o.createRef(),n.toDispose=[],n.mounted=!1;var r=t.formInited,s=t.addHook,a=t.formItem,l=function(){return(0,i.mG)(n,void 0,void 0,function(){var e=this;return(0,i.Jh)(this,function(t){switch(t.label){case 0:return[4,this.fetchOptions()];case 1:return t.sent(),this.mounted&&this.toDispose.push((0,b.U5)(function(){return JSON.stringify(null==a?void 0:a.tmpValue)},function(){return e.fetchOptions()})),[2]}})})};return a&&n.toDispose.push(r||!s?a.addInitHook(l):s(l,"init")),n}return(0,i.ZT)(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentDidUpdate=function(e){var t,n=this.props;["multiple","source","pickerSchema"].some(function(t){return!d()(e[t],n[t])})?this.setState({schema:this.buildSchema(n)}):(0,f.rMT)(e.source,n.source,e.data,n.data)&&(null==(t=n.formItem)?void 0:t.inited)&&this.fetchOptions()},t.prototype.componentWillUnmount=function(){this.toDispose.forEach(function(e){return e()}),this.toDispose=[],this.mounted=!1},t.prototype.fetchOptions=function(){var e,t,n=this.props,i=n.value,o=n.formItem,r=n.valueField,s=n.labelField,a=n.source,l=n.data;if(!(!a||!o||(r||"value")===(s||"label")||(t=o.getSelectedOptions(i))&&(!t.length||t[0][r||"value"]!==t[0][s||"label"]))){var p=(0,f.nW9)(l,((e={value:i})[r||"value"]=i,e.op="loadOptions",e));if((0,f.SSQ)(a))o.setOptions((0,f.OgC)(a,l,"| raw"));else if((0,f.X1t)(a,p))return o.loadOptions(a,p,{autoAppend:!0})}},t.prototype.buildSchema=function(e){var t,n,o=(0,f.SSQ)(e.source);return(0,i.pi)((0,i.pi)({checkOnItemClick:!0,listItem:{title:"${".concat(e.labelField||"label","|raw}")}},e.pickerSchema),{labelTpl:null!=(n=null==(t=e.pickerSchema)?void 0:t.labelTpl)?n:e.labelTpl,type:"crud",pickerMode:!0,syncLocation:!1,filterCanAccessSuperData:!1,api:o?null:e.source,source:o?e.source:null,keepItemSelectionOnPageChange:!0,valueField:e.valueField,labelField:e.labelField,bulkActions:e.multiple?e.pickerSchema.bulkActions:[]})},t.prototype.crudRef=function(e){for(;e&&e.getWrappedInstance;)e=e.getWrappedInstance();this.crud=e},t.prototype.reload=function(){if(this.crud)this.crud.search();else{var e=this.props.reloadOptions;e&&e()}},t.prototype.open=function(){this.setState({isOpened:!0})},t.prototype.close=function(){this.setState({isOpened:!1})},t.prototype.handleModalConfirm=function(e,t,n,o){return(0,i.mG)(this,void 0,void 0,function(){var t;return(0,i.Jh)(this,function(n){switch(n.label){case 0:return t=m()(o,function(e){return"crud"===e.props.type}),[4,this.handleChange(e[t].items)];case 1:return n.sent(),this.close(),[2]}})})},t.prototype.handleChange=function(e){return(0,i.mG)(this,void 0,void 0,function(){var t,n,o,r,s,a,l,p,u,d,h,m,v,g;return(0,i.Jh)(this,function(i){switch(i.label){case 0:return n=(t=this.props).joinValues,o=t.valueField,r=t.delimiter,s=t.extractValue,a=t.multiple,l=t.options,t.data,p=t.dispatchEvent,t.selectedOptions,u=t.setOptions,d=t.onChange,h=e,h=n?e.map(function(e){return e[o||"value"]}).join(r||","):s?a?e.map(function(e){return e[o||"value"]}):e[0]&&e[0][o||"value"]||"":a?e:e[0],m=[],e.forEach(function(e){c()(l,function(t){return e[o||"value"]==t[o||"value"]})||m.push(e)}),m.length&&u(l.concat(m)),v=a?e:e[0],[4,p("change",(0,f.vXk)(this.props,{value:h,option:v,selectedItems:v}))];case 1:if(null==(g=i.sent())?void 0:g.prevented)return[2];return d(h),[2]}})})},t.prototype.handleItemClick=function(e){return(0,i.mG)(this,void 0,void 0,function(){var t,n,o;return(0,i.Jh)(this,function(i){switch(i.label){case 0:return n=(t=this.props).data,[4,(0,t.dispatchEvent)("itemClick",(0,f.nW9)(n,{item:e}))];case 1:return null==(o=i.sent())||o.prevented,[2]}})})},t.prototype.removeItem=function(e){return(0,i.mG)(this,void 0,void 0,function(){var t,n,o,r,s,a,l,p,c,u,d,h,m;return(0,i.Jh)(this,function(v){switch(v.label){case 0:return n=(t=this.props).selectedOptions,o=t.joinValues,r=t.extractValue,s=t.delimiter,a=t.valueField,l=t.onChange,p=t.multiple,c=t.dispatchEvent,u=n.concat(),d=(0,i.CR)(u.splice(e,1),1)[0],h=u,h=o?u.map(function(e){return e[a||"value"]}).join(s||","):r?p?u.map(function(e){return e[a||"value"]}):u[0]&&u[0][a||"value"]||"":p?u:u[0],[4,c("change",(0,f.vXk)(this.props,{value:h,option:d,selectedItems:d}))];case 1:if(null==(m=v.sent())?void 0:m.prevented)return[2];return l(h),[2]}})})},t.prototype.handleKeyDown=function(e){var t=this.props.selectedOptions;" "===e.key?(this.open(),e.preventDefault()):t.length&&"Backspace"==e.key&&this.removeItem(t.length-1)},t.prototype.handleFocus=function(e){this.input.current&&this.input.current.focus(),e.stopPropagation(),this.setState({isFocused:!0})},t.prototype.handleBlur=function(){this.setState({isFocused:!1})},t.prototype.handleClick=function(){this.open()},t.prototype.clearValue=function(e){e.stopPropagation();var t=this.props,n=t.onChange,i=t.resetValue;n(void 0!==i?i:"")},t.prototype.getOverflowConfig=function(){var e=this.props.overflowConfig;return g()(t.defaultProps.overflowConfig,e)},t.prototype.handleSelect=function(e,t){var n=this.props,i=n.selectedOptions,o=n.valueField;if(Array.isArray(e)&&Array.isArray(t)&&(e.length||t.length)){var r=C()(e,i,function(e,t){var n=e[o||"value"],i=t[o||"value"];return n||i?n===i:d()(l()(e,"value"),l()(t,"value"))});(r.length!==e.length||r.length!==i.length)&&this.handleChange(e)}},t.prototype.renderTag=function(e,t){var n=this,r=this.props,s=r.itemClearable,a=r.classPrefix,l=r.classnames,p=r.labelField,c=r.labelTpl,u=(r.translate,r.disabled),d=r.env,h=r.id,m=r.themeCss,v=r.css;return o.createElement("div",{key:t,className:l("".concat(a,"Picker-value"),(0,f.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"pickValueWrapClassName",id:h,themeCss:m||v})),{"is-disabled":u})},(void 0===s||s)&&o.createElement("span",{className:l("".concat(a,"Picker-valueIcon"),(0,f.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"pickValueIconClassName",id:h,themeCss:m||v}))),onClick:function(e){e.stopPropagation(),n.removeItem(t)}},"\xd7"),o.createElement(y.m,{inline:!1,tooltip:(0,f.E04)(e,p||"label")},o.createElement("span",{className:l("".concat(a,"Picker-valueLabel"),(0,f.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"pickFontClassName",id:h,themeCss:m||v}))),onClick:function(t){t.stopPropagation(),n.handleItemClick(e)}},c?o.createElement(y.Vt,{html:(0,f.hXT)(c,e),filterHtml:d.filterHtml}):"".concat((0,f.E04)(e,p||"label")||(0,f.E04)(e,"id")))))},t.prototype.renderValues=function(){var e=this,t=this.props,n=t.classPrefix,r=t.selectedOptions,a=t.translate,p=t.disabled,c=t.multiple,u=t.popOverContainer,d=t.id,h=t.themeCss,m=t.css,v=this.getOverflowConfig(),g=v.maxTagCount,w=v.overflowTagPopover,C=r.length,k=r,b=!1!==c&&(0,f.wYV)(g,{start:0,end:C,left:"inclusive",right:"exclusive"});return b&&(k=(0,i.ev)((0,i.ev)([],(0,i.CR)(r.slice(0,g)),!1),[{label:"+ ".concat(C-g," ..."),value:"__overflow_tag__"}],!1)),o.createElement(o.Fragment,null,k.map(function(t,c){return b&&c===g?o.createElement(y.pf,{key:c,container:u,tooltip:(0,i.pi)((0,i.pi)({tooltipClassName:s()("Picker-overflow",null==w?void 0:w.tooltipClassName),title:a("已选项")},l()(w,["children","content","tooltipClassName"])),{children:function(){return o.createElement("div",{className:s()("".concat(n,"Picker-overflow-wrapper"))},r.slice(g,C).map(function(t,n){var i=n+g;return e.renderTag(t,i)}))}})},o.createElement("div",{key:c,className:s()("".concat(n,"Picker-value"),{"is-disabled":p})},o.createElement("span",{className:"".concat(n,"Picker-valueLabel ").concat((0,f.GwQ)((0,i.pi)((0,i.pi)({},e.props),{name:"pickFontClassName",id:d,themeCss:h||m})))},t.label))):e.renderTag(t,c)}))},t.prototype.overrideCRUDProps=function(){return{}},t.prototype.renderBody=function(e){var t=(void 0===e?{}:e).popOverContainer,n=this.props,o=n.render,r=n.selectedOptions,s=n.options,a=n.multiple,l=n.valueField,p=n.embed,c=n.source,u=n.strictMode,d=n.testIdBuilder,h=this.getOverflowConfig(),m=h.maxTagCount,v=h.overflowTagPopoverInCRUD,g=h.displayPosition;return o("modal-body",this.state.schema,(0,i.pi)((0,i.pi)({value:r,valueField:l,primaryField:l,options:c?[]:s,multiple:a,strictMode:u,onSelect:p?this.handleSelect:void 0,testIdBuilder:null==d?void 0:d.getChild("body-schema"),ref:this.crudRef,popOverContainer:t},p||Array.isArray(g)&&g.includes("crud")?{maxTagCount:m,overflowTagPopover:v}:{}),this.overrideCRUDProps()))},t.prototype.render=function(){var e=this.props,t=e.className,n=(e.style,e.modalClassName),r=e.classnames,s=e.disabled,a=e.render,l=e.modalMode,p=e.source,c=e.size,u=e.clearable,d=e.multiple,h=e.placeholder,m=e.embed,v=e.selectedOptions,g=e.translate,w=e.popOverContainer,C=e.modalTitle,k=e.data,b=e.mobileUI,N=e.env,O=e.themeCss,F=e.css,P=e.id,I=e.classPrefix,E=e.testIdBuilder;return o.createElement("div",{className:r("PickerControl",{"is-mobile":b},t)},m?o.createElement("div",{className:r("Picker")},this.renderBody({popOverContainer:w})):o.createElement("div",{className:r("Picker",{"Picker--single":!d,"Picker--multi":d,"is-focused":this.state.isFocused,"is-disabled":s})},o.createElement("div",{onClick:this.handleClick,className:r("Picker-input",s&&"is-disabled",this.state.isFocused&&"is-focused",(0,f.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"pickControlClassName",id:P,themeCss:O||F})))},!v.length&&h?o.createElement("div",{className:r("Picker-placeholder")},g(h)):o.createElement("div",(0,i.pi)({className:r("Picker-valueWrap")},null==E?void 0:E.getTestId()),this.renderValues(),o.createElement("input",{onChange:f.ZTd,value:"",ref:this.input,onKeyDown:this.handleKeyDown,onClick:this.handleFocus,onBlur:this.handleBlur,readOnly:b})),u&&!s&&v.length?o.createElement("a",{onClick:this.clearValue,className:r("Picker-clear")},o.createElement(y.JO,{icon:"input-clear",className:"icon"})):null,o.createElement("span",(0,i.pi)({onClick:this.open,className:r("Picker-btn")},null==E?void 0:E.getChild("picker-open-btn").getTestId()),o.createElement(y.JO,{icon:"window-restore",className:r("icon",(0,f.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"pickIconClassName",id:P,themeCss:O||F}))),iconContent:"Picker-icon"}))),a("modal",{title:C&&"string"==typeof C?(0,f.hXT)(C,k):g("Select.placeholder"),size:c,type:l,className:n,body:{children:this.renderBody},testIdBuilder:null==E?void 0:E.getChild("modal")},{key:"modal",lazyRender:!!p,onConfirm:this.handleModalConfirm,onClose:this.close,show:this.state.isOpened})),o.createElement(f.cWM,(0,i.pi)({},this.props,{config:{themeCss:O||F,classNames:[{key:"pickControlClassName",weights:{default:{important:!0},hover:{important:!0},focused:{important:!0,parent:".".concat(I,"Picker.is-focused >")},disabled:{important:!0,parent:".".concat(I,"Picker.is-disabled >")}}},{key:"pickFontClassName"},{key:"pickValueWrapClassName",weights:{default:{important:!0}}},{key:"pickValueIconClassName",weights:{default:{important:!0},hover:{important:!0}}},{key:"pickIconClassName",weights:{default:{suf:" svg"}}}],id:P},env:N})))},t.propsList=["modalTitle","modalMode","pickerSchema","labelField","onChange","options","value","inline","multiple","embed","resetValue","placeholder","onQuery"],t.defaultProps={modalMode:"dialog",multiple:!1,placeholder:"Picker.placeholder",labelField:"label",valueField:"value",pickerSchema:{mode:"list"},embed:!1,overflowConfig:{maxTagCount:-1,displayPosition:["select","crud"],overflowTagPopover:{placement:"top",trigger:"hover",showArrow:!1,offset:[0,-5]},overflowTagPopoverInCRUD:{placement:"bottom",trigger:"hover",showArrow:!1,offset:[0,0]}}},(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",Object)],t.prototype,"fetchOptions",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],t.prototype,"crudRef",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"open",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"close",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array,Object,Object,Array]),(0,i.w6)("design:returntype",Promise)],t.prototype,"handleModalConfirm",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array]),(0,i.w6)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",Promise)],t.prototype,"handleItemClick",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],t.prototype,"handleKeyDown",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],t.prototype,"handleFocus",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"handleBlur",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"handleClick",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],t.prototype,"clearValue",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Array,Array]),(0,i.w6)("design:returntype",void 0)],t.prototype,"handleSelect",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"overrideCRUDProps",null),(0,i.gn)([f.NjZ,(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[Object]),(0,i.w6)("design:returntype",void 0)],t.prototype,"renderBody",null),(0,i.gn)([(0,k.i)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"render",null),t}(o.PureComponent),O=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t=(0,i.gn)([(0,f.oZB)({type:"picker",autoLoadOptionsFromSource:!1,sizeMutable:!1})],t)}(N)}}]);