"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["5414"],{29111:function(e,t,n){n.r(t),n.d(t,{ChainedSelectControlRenderer:()=>m,default:()=>v});var i=n(9787),a=n(65758),o=n(84875),l=n.n(o),s=n(47755),r=n(68333),p=n(81415),c=n(33170),u=n.n(c),d=n(82691),h=n.n(d),v=function(e){function t(t){var n=e.call(this,t)||this;return n.state={stack:[]},n.handleChange=n.handleChange.bind(n),n.loadMore=n.loadMore.bind(n),n}return(0,i.ZT)(t,e),t.prototype.componentDidMount=function(){var e,t;this.props.formInited||!this.props.addHook?this.loadMore():null==(t=(e=this.props).addHook)||t.call(e,this.loadMore,"init")},t.prototype.componentDidUpdate=function(e){var t=this.props;e.options!==t.options?this.setState({stack:[]}):t.formInited&&t.value!==e.value&&this.loadMore()},t.prototype.doAction=function(e,t,n){var i,a,o=this.props,l=o.resetValue,r=o.onChange,p=o.formStore,c=o.store,u=o.name,d=null==e?void 0:e.actionType;if("clear"===d)r("");else if("reset"===d){var h=null!=(a=(0,s.E04)(null!=(i=null==p?void 0:p.pristine)?i:null==c?void 0:c.pristine,u))?a:l;r(null!=h?h:"")}},t.prototype.array2value=function(e,t){void 0===t&&(t=!1);var n=this.props,i=n.delimiter,a=n.joinValues,o=n.extractValue,l=n.valueField;return t?a?e.join(i||","):e:a?e.join(i||","):o?e.map(function(e){return e[l||"value"]||e}):e},t.prototype.loadMore=function(){for(var e=this,t=this.props,n=t.value,a=t.delimiter,o=t.onChange,l=t.joinValues,r=t.extractValue,p=t.valueField,c=t.source,u=t.data,d=t.env,v=t.dispatchEvent,m=Array.isArray(n)?n.concat():n&&"string"==typeof n?n.split(a||","):[],f=0,C=this.state.stack.length;f<C&&m[f]&&this.state.stack[f].parentId==(l||r?m[f]:m[f][p||"value"]);)f++;if(m[f]&&d&&(0,s.X1t)(c,u)){var g=l||r?m[f]:m[f][p||"value"],y=this.state.stack.concat();y.splice(f,y.length-f),y.push({parentId:g,loading:!0,options:[]}),this.setState({stack:y},function(){d.fetcher(c,(0,i.pi)((0,i.pi)({},u),{value:m,level:f+1,parentId:g,parent:m[f]})).then(function(t){return(0,i.mG)(e,void 0,void 0,function(){var e,a,l,r,c,u,d,C;return(0,i.Jh)(this,function(i){switch(i.label){case 0:if(e=this.state.stack.concat(),a=t.data?t.data[p||"value"]:void 0,l=(null==(u=null==t?void 0:t.data)?void 0:u.options)||(null==(d=null==t?void 0:t.data)?void 0:d.items)||(null==(C=null==t?void 0:t.data)?void 0:C.rows)||t.data||[],e.splice(f,e.length-f),void 0===a)return[3,2];return m.splice(f+1,n.length-f-1),m.push(a),r=this.array2value(m,!0),[4,v("change",(0,s.vXk)(this.props,{value:r}))];case 1:if(null==(c=i.sent())?void 0:c.prevented)return[2];o(r),i.label=2;case 2:return e.push({options:l,parentId:g,loading:!1,visible:Array.isArray(l)&&!h()(l)}),this.setState({stack:e},this.loadMore),[2]}})})}).catch(function(e){(null==c?void 0:c.silent)||d.notify("error",e.message)})})}},t.prototype.handleChange=function(e,t){return(0,i.mG)(this,void 0,void 0,function(){var n,a,o,l,r,p,c,u,d,h,v;return(0,i.Jh)(this,function(i){switch(i.label){case 0:return a=(n=this.props).value,o=n.delimiter,l=n.onChange,r=n.joinValues,n.extractValue,p=n.dispatchEvent,c=n.valueField,n.data,(u=Array.isArray(a)?a.concat():a&&"string"==typeof a?a.split(o||","):[]).splice(e,u.length-e),void 0!==(d=r?t[c||"value"]:t)&&u.push(d),h=this.array2value(u),[4,p("change",(0,s.vXk)(this.props,{value:h}))];case 1:if(null==(v=i.sent())?void 0:v.prevented)return[2];return l(h),[2]}})})},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.renderStatic=function(e){void 0===e&&(e="-");var t=this.props,n=t.options,o=t.labelField,l=t.valueField,s=t.classPrefix,r=t.classnames,p=t.className,c=t.value,d=t.delimiter,h=(0,i.ev)([{options:void 0===n?[]:n,visible:!0}],(0,i.CR)(this.state.stack||[]),!1),v=Array.isArray(c)?c.concat():c&&"string"==typeof c?c.split(d||","):[];return(null==v?void 0:v.length)>0&&(e=v.map(function(e,t){var n,i=h[t]||{},a=i.options;return!1===i.visible?null:a&&a.length&&null!=(n=(u()(a,function(t){return e===t[l||"value"]})||{})[o||"label"])?n:e}).filter(function(e){return null!=e}).join(" > ")),a.createElement("div",{className:r("".concat(s,"SelectStaticControl"),p)},e)},t.prototype.render=function(){var e=this,t=this.props,n=t.options,o=t.classPrefix,p=t.className,c=t.style,u=(t.inline,t.loading),d=t.value,h=t.delimiter,v=(t.joinValues,t.extractValue,t.multiple,t.mobileUI),m=t.env,f=t.testIdBuilder,C=t.popoverClassName,g=(0,i._T)(t,["options","classPrefix","className","style","inline","loading","value","delimiter","joinValues","extractValue","multiple","mobileUI","env","testIdBuilder","popoverClassName"]),y=Array.isArray(d)?d.concat():d&&"string"==typeof d?d.split(h||","):[],b=this.props,k=b.themeCss,S=b.id,N=this.state.stack.find(function(e){return e.loading});return a.createElement("div",{className:l()("".concat(o,"ChainedSelectControl"),p)},a.createElement(r.Ph,(0,i.pi)({},g,{mobileUI:v,popOverContainer:v?null==m?void 0:m.getModalContainer:g.popOverContainer||(null==m?void 0:m.getModalContainer),className:l()((0,s.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"chainedSelectControlClassName",id:S,themeCss:k}))),popoverClassName:l()(C,(0,s.GwQ)((0,i.pi)((0,i.pi)({},this.props),{name:"chainedSelectPopoverClassName",id:S,themeCss:k}))),controlStyle:c,classPrefix:o,key:"base",testIdBuilder:null==f?void 0:f.getChild("base"),options:Array.isArray(n)?n:[],value:y[0],onChange:this.handleChange.bind(this,0),loading:u,inline:!0})),this.state.stack.map(function(t,n){var p=t.options,u=t.loading;return!1===t.visible||u?null:a.createElement(r.Ph,(0,i.pi)({},g,{mobileUI:v,popOverContainer:v?m.getModalContainer:g.popOverContainer||(null==m?void 0:m.getModalContainer),classPrefix:o,key:"x-".concat(n+1),testIdBuilder:null==f?void 0:f.getChild("x-".concat(n+1)),options:Array.isArray(p)?p:[],value:y[n+1],onChange:e.handleChange.bind(e,n+1),inline:!0,controlStyle:c,className:l()((0,s.GwQ)((0,i.pi)((0,i.pi)({},e.props),{name:"chainedSelectControlClassName",id:S,themeCss:k}))),popoverClassName:l()(C,(0,s.GwQ)((0,i.pi)((0,i.pi)({},e.props),{name:"chainedSelectPopoverClassName",id:S,themeCss:k})))}))}),N&&a.createElement(r.$j,{size:"sm",className:l()("".concat(o,"ChainedSelectControl-spinner"))}),a.createElement(s.cWM,(0,i.pi)({},this.props,{config:{themeCss:k,classNames:[{key:"chainedSelectControlClassName",weights:{focused:{suf:".is-opened:not(.is-mobile)"},disabled:{suf:".is-disabled"}}},{key:"chainedSelectPopoverClassName",weights:{default:{suf:" .".concat(o,"Select-option")},hover:{suf:" .".concat(o,"Select-option.is-highlight")},focused:{inner:".".concat(o,"Select-option.is-active")}}}],id:S},env:m})))},t.defaultProps={clearable:!1,searchable:!1,multiple:!0},(0,i.gn)([(0,p.i)(),(0,i.w6)("design:type",Function),(0,i.w6)("design:paramtypes",[]),(0,i.w6)("design:returntype",void 0)],t.prototype,"render",null),t}(a.Component),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t=(0,i.gn)([(0,s.oZB)({type:"chained-select",sizeMutable:!1})],t)}(v)}}]);