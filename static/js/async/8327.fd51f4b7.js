"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["8327"],{91361:function(t,e,n){n.r(e),n.d(e,{IFrameRenderer:()=>o,default:()=>i});var s=n(9787),r=n(65758),a=n(47755),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.IFrameRef=r.createRef(),e.state={width:e.props.width||"100%",height:e.props.height||"100%"},e}return(0,s.ZT)(e,t),e.prototype.componentDidMount=function(){window.addEventListener("message",this.onMessage)},e.prototype.componentDidUpdate=function(t){var e=this.props.data;e!==t.data?this.postMessage("update",e):(this.props.width!==t.width||this.props.height!==t.height)&&this.setState({width:this.props.width||"100%",height:this.props.height||"100%"})},e.prototype.componentWillUnmount=function(){window.removeEventListener("message",this.onMessage)},e.prototype.validateURL=function(t){return!!(t&&"string"==typeof t&&/^data:([a-zA-Z0-9]+\/[a-zA-Z0-9]+);base64,.*/.test(t))||!t||"string"!=typeof t||!!/^(\.\/|\.\.\/|\/|(blob\:)?https?\:\/\/|\/\/)/.test(t)},e.prototype.onMessage=function(t){var e,n,r;return(0,s.mG)(this,void 0,void 0,function(){var i,o,p,d,l,c,h,u,m,g,y;return(0,s.Jh)(this,function(v){switch(v.label){case 0:if(o=(i=this.props).events,p=i.onEvent,d=i.onAction,l=i.data,"string"!=typeof(null==(e=null==t?void 0:t.data)?void 0:e.type)||(h=(c=(0,s.CR)(t.data.type.split(":"),2))[0],u=c[1],"amis"!==h||!u))return[2];if(!("resize"===u&&t.data.data))return[3,1];return this.setState({width:t.data.data.width||"100%",height:t.data.data.height||"100%"}),[3,4];case 1:if(!((m=null==p?void 0:p[u])&&(null==(n=m.actions)?void 0:n.length)))return[3,3];return g=(0,a.ALw)(u,{env:null==(r=this.props)?void 0:r.env,nativeEvent:t,data:(0,a.nW9)(l,t.data.data),scoped:this.context}),[4,(0,a.X1x)(m.actions,this,g)];case 2:if(v.sent(),g.prevented)return[2];v.label=3;case 3:o&&(y=o[u])&&d(t,y,(0,a.nW9)(l,t.data.data)),v.label=4;case 4:return[2]}})})},e.prototype.onLoad=function(){var t=this.props,e=t.src,n=t.data;e&&this.postMessage("init",n)},e.prototype.reload=function(t,e){if(e)return this.receive(e);var n=this.props,s=n.src,r=n.data;s&&(this.IFrameRef.current.src=(0,a.OgC)(s,r,"| raw"))},e.prototype.receive=function(t){var e=this.props,n=e.src,s=e.data,r=(0,a.nW9)(s,t);this.postMessage("receive",r),(0,a.rMT)(n,n,s,r)&&(this.IFrameRef.current.src=(0,a.OgC)(n,r,"| raw"))},e.prototype.postMessage=function(t,e){var n,s;null==(s=null==(n=this.IFrameRef.current)?void 0:n.contentWindow)||s.postMessage({type:"amis:".concat(t),data:JSON.parse(JSON.stringify(e))},"*")},e.prototype.render=function(){var t=this.state,e=t.width,n=t.height,i=this.props,o=i.className,p=i.src,d=i.name,l=i.frameBorder,c=i.data,h=i.style,u=i.allow,m=i.sandbox,g=i.referrerpolicy,y=i.translate,v=i.id,f=i.wrapperCustomStyle,w=i.env,C=i.themeCss,b=(i.baseControlClassName,i.classnames),N={};void 0!==e&&(N.width=e),void 0!==n&&(N.height=n),h=(0,s.pi)((0,s.pi)({},N),h);var M=p?(0,a.OgC)(p,c,"| raw"):void 0;return this.validateURL(M)?("https:"===location.protocol&&M&&M.startsWith("http://")&&w.notify("error",y("Iframe.invalidProtocol")),r.createElement(r.Fragment,null,r.createElement("iframe",{name:d,className:b("IFrame",o,(0,a.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"baseControlClassName",id:v,themeCss:C})),(0,a.GwQ)((0,s.pi)((0,s.pi)({},this.props),{name:"wrapperCustomStyle",id:v,themeCss:f}))),frameBorder:l,style:h,ref:this.IFrameRef,onLoad:this.onLoad,src:M,allow:u,referrerPolicy:g,sandbox:m}),r.createElement(a.cWM,(0,s.pi)({},this.props,{config:{wrapperCustomStyle:f,id:v,themeCss:C,classNames:[{key:"baseControlClassName"}]},env:w})))):r.createElement("p",null,y("Iframe.invalid"))},e.propsList=["src","className"],e.defaultProps={className:"",frameBorder:0},(0,s.gn)([a.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[MessageEvent]),(0,s.w6)("design:returntype",Promise)],e.prototype,"onMessage",null),(0,s.gn)([a.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[]),(0,s.w6)("design:returntype",void 0)],e.prototype,"onLoad",null),(0,s.gn)([a.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[Object,Object]),(0,s.w6)("design:returntype",void 0)],e.prototype,"reload",null),(0,s.gn)([a.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[Object]),(0,s.w6)("design:returntype",void 0)],e.prototype,"receive",null),(0,s.gn)([a.NjZ,(0,s.w6)("design:type",Function),(0,s.w6)("design:paramtypes",[String,Object]),(0,s.w6)("design:returntype",void 0)],e.prototype,"postMessage",null),e}(r.Component),o=function(t){function e(e,n){var s=t.call(this,e)||this;return n.registerComponent(s),s}return(0,s.ZT)(e,t),e.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),t.prototype.componentWillUnmount.call(this)},e.contextType=a.ZHe,e=(0,s.gn)([(0,a.Thl)({type:"iframe"}),(0,s.w6)("design:paramtypes",[Object,Object])],e)}(i)}}]);