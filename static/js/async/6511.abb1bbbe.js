"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["6511"],{48254:function(e,t,n){n.r(t),n.d(t,{PageRenderer:()=>p,PageRendererBase:()=>d,default:()=>l});var a=n(9787),o=n(65758),i=n(47755),r=n(68333),s=n(6663),l=function(e){function t(t){var n=e.call(this,t)||this;return(0,i.Ius)(n,["handleAction","handleChange","handleBulkChange","handleQuery","handleDialogConfirm","handleDialogClose","handleDrawerConfirm","handleDrawerClose","handleClick","reload","silentReload","initInterval"]),n.style=document.createElement("style"),n.style.setAttribute("data-page",""),document.getElementsByTagName("head")[0].appendChild(n.style),n.updateStyle(),n.varStyle=document.createElement("style"),n.varStyle.setAttribute("data-vars",""),document.getElementsByTagName("head")[0].appendChild(n.varStyle),n.updateVarStyle(),n}return(0,a.ZT)(t,e),t.prototype.updateStyle=function(){this.props.css||this.props.mobileCSS?this.style.innerHTML="\n      ".concat(this.buildCSS(this.props.css),"\n\n      @media (max-width: 768px) {\n        ").concat(this.buildCSS(this.props.mobileCSS),"\n      }\n      "):this.style.innerHTML=""},t.prototype.buildCSS=function(e){if(!e)return"";var t="";for(var n in e){var a=e[n],o="";for(var i in a){var r="",s=a[i];if("string"==typeof s)o+="  ".concat(i,": ").concat(s,";\n");else{for(var l in s)r+=" ".concat(l,":").concat(s[l],";");o+="  ".concat(i," {").concat(r,"}\n")}}t+="\n      ".concat(n," {\n        ").concat(o,"\n      }\n      ")}return t},t.prototype.updateVarStyle=function(){var e=this.props.cssVars,t="";if(e){for(var n in e)if(n.startsWith("--")){if(-1!==n.indexOf(":"))continue;var a=e[n];if("string"==typeof a&&(-1!==a.indexOf("expression(")||-1!==a.indexOf(";")))continue;t+="".concat(n,": ").concat(a,"; \n")}this.varStyle.innerHTML="\n      :root {\n        ".concat(t,"\n      }\n      ")}},t.prototype.componentDidMount=function(){return(0,a.mG)(this,void 0,void 0,function(){var e,t,n,o,r,l,d,p,c,h;return(0,a.Jh)(this,function(a){switch(a.label){case 0:return t=(e=this.props).initApi,n=e.initFetch,o=e.initFetchOn,r=e.store,l=e.messages,d=e.data,p=e.dispatchEvent,c=e.env,this.mounted=!0,[4,p("init",d,this)];case 1:if(h=a.sent(),(null==c?void 0:c.tracker)&&c.tracker({eventType:"pageLoaded"},this.props),(null==h?void 0:h.prevented)||!(0,s.fh)(r))return[2];return(0,i.X1t)(t,r.data,n,o)&&r.fetchInitData(t,r.data,{successMessage:l&&l.fetchSuccess,errorMessage:l&&l.fetchFailed}).then(this.initInterval),[2]}})})},t.prototype.componentDidUpdate=function(e){var t=this.props,n=t.store,a=t.initApi;if(t.initFetchOn&&t.initFetch&&!e.initFetch||!1!==t.initFetch&&(0,i.rMT)(e.initApi,a,e.data,t.data)){var o=t.messages;(0,i.X1t)(a,n.data)&&n.fetchData(a,n.data,{successMessage:o&&o.fetchSuccess,errorMessage:o&&o.fetchFailed}).then(this.initInterval)}(JSON.stringify(t.css)!==JSON.stringify(e.css)||JSON.stringify(t.mobileCSS)!==JSON.stringify(e.mobileCSS))&&this.updateStyle(),JSON.stringify(t.cssVars)!==JSON.stringify(e.cssVars)&&this.updateVarStyle(),(0,i.RjM)(e.defaultData,t.defaultData)&&n.reInitData(t.defaultData)},t.prototype.componentWillUnmount=function(){var e,t;this.mounted=!1,clearTimeout(this.timer),this.style&&(null==(e=this.style.parentNode)||e.removeChild(this.style)),this.varStyle&&(null==(t=this.varStyle.parentNode)||t.removeChild(this.varStyle))},t.prototype.reloadTarget=function(e,t){},t.prototype.handleAction=function(e,t,n,o,r){var s=this;void 0===o&&(o=!1);var l=this.props,d=l.env,p=l.store,c=l.messages,h=l.onAction;if("dialog"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){p.openDialog(n,void 0,function(n,a){var o;null==(o=t.callback)||o.call(t,n,a),e({confirmed:n,value:a})},r||s.context)});if("drawer"===t.actionType)return p.setCurrentAction(t,this.props.resolveDefinitions),new Promise(function(e){p.openDrawer(n,void 0,function(n,a){var o;null==(o=t.callback)||o.call(t,n,a),e({confirmed:n,value:a})},r)});if("ajax"!==t.actionType)return h(e,t,n,o,r||this.context);if(p.setCurrentAction(t,this.props.resolveDefinitions),(0,i.X1t)(t.api,n))return p.saveRemote(t.api,n,{successMessage:t.messages&&t.messages.success||c&&c.saveSuccess,errorMessage:t.messages&&t.messages.failed||c&&c.saveSuccess}).then(function(){return(0,a.mG)(s,void 0,void 0,function(){var e;return(0,a.Jh)(this,function(n){switch(n.label){case 0:if(!(t.feedback&&(0,i.pn4)(t.feedback,p.data)))return[3,2];return[4,this.openFeedback(t.feedback,p.data)];case 1:n.sent(),n.label=2;case 2:return(e=t.redirect&&(0,i.hXT)(t.redirect,p.data))&&d.jumpTo(e,t,p.data),t.reload&&this.reloadTarget((0,i.u22)(t.reload,p.data),p.data),[2]}})})}).catch(function(e){if(o||t.countDown)throw e})},t.prototype.handleQuery=function(e){return this.props.initApi?(null==e||!e.hasOwnProperty("orderBy")||!!(0,i.rMT)(this.props.initApi,this.props.initApi,this.props.store.data,(0,i.nW9)(this.props.store.data,e)))&&void this.receive(e):!!this.props.onQuery&&this.props.onQuery(e)},t.prototype.handleDialogConfirm=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,a.ev)([e,t],(0,a.CR)(n),!1))||i.closeDialog(!0,e)},t.prototype.handleDialogClose=function(e){void 0===e&&(e=!1),this.props.store.closeDialog(e)},t.prototype.handleDrawerConfirm=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var i=this.props.store;t.mergeData&&1===e.length&&e[0]&&i.updateData(e[0]);var r=i.action.dialog;r&&r.onConfirm&&!1===r.onConfirm.apply(r,(0,a.ev)([e,t],(0,a.CR)(n),!1))||i.closeDrawer(!0,e)},t.prototype.handleDrawerClose=function(){this.props.store.closeDrawer(!1)},t.prototype.handleClick=function(e){var t,n=e.target,a=this.props.env,o="A"===n.tagName&&n.hasAttribute("data-link")?n.getAttribute("data-link"):null==(t=n.closest("a[data-link]"))?void 0:t.getAttribute("data-link");a&&o&&(a.jumpTo(o,void 0,this.props.data),e.preventDefault())},t.prototype.handleResizeMouseDown=function(e){3!=e.nativeEvent.which&&(this.codeWrap=e.currentTarget.parentElement,document.addEventListener("mousemove",this.handleResizeMouseMove),document.addEventListener("mouseup",this.handleResizeMouseUp),this.startX=e.clientX,this.startWidth=this.codeWrap.offsetWidth)},t.prototype.handleResizeMouseMove=function(e){var t=this.props,n=t.asideMinWidth,a=t.asideMaxWidth,o=t.asidePosition,i=e.clientX-this.startX,r=Math.min(Math.max("right"===o?this.startWidth-i:this.startWidth+i,void 0===n?160:n),void 0===a?350:a);this.codeWrap.style.cssText+="width: ".concat(r,"px")},t.prototype.handleResizeMouseUp=function(){document.removeEventListener("mousemove",this.handleResizeMouseMove),document.removeEventListener("mouseup",this.handleResizeMouseUp)},t.prototype.openFeedback=function(e,t){var n=this;return new Promise(function(a){var o=n.props.store;o.setCurrentAction({type:"button",actionType:"dialog",dialog:e},n.props.resolveDefinitions),o.openDialog(t,void 0,function(e){a(e)},n.context)})},t.prototype.reload=function(e,t,n,o,r){return(0,a.mG)(this,void 0,void 0,function(){var e,n,s,l;return(0,a.Jh)(this,function(a){switch(a.label){case 0:if(t)return[2,this.receive(t,void 0,r)];if(n=(e=this.props).store,s=e.initApi,clearTimeout(this.timer),!(0,i.X1t)(s,n.data))return[3,2];return[4,n.fetchData(s,n.data,{silent:o})];case 1:l=a.sent(),this.initInterval(l),a.label=2;case 2:return[2,n.data]}})})},t.prototype.receive=function(e,t,n){this.props.store.updateData(e,void 0,n),this.reload()},t.prototype.silentReload=function(e,t){this.reload(t,void 0,void 0,!0)},t.prototype.initInterval=function(e){var t,n=this.props,o=n.interval,r=n.silentPolling,s=n.stopAutoRefreshWhen,l=n.data,d=n.dispatchEvent,p=n.store;return d("inited",(0,i.nW9)(l,(0,a.pi)((0,a.pi)({},null==e?void 0:e.data),{responseData:(null==e?void 0:e.ok)?null!=(t=null==e?void 0:e.data)?t:{}:e,responseStatus:(null==e?void 0:e.status)===void 0?+(null!=p&&!!p.error):null==e?void 0:e.status,responseMsg:(null==e?void 0:e.msg)||(null==p?void 0:p.msg)}))),(null==e?void 0:e.ok)&&o&&this.mounted&&(!s||!(0,i.fz_)(s,l))&&(this.timer=setTimeout(r?this.silentReload:this.reload,Math.max(o,1e3))),e},t.prototype.handleRefresh=function(){return(0,a.mG)(this,void 0,void 0,function(){var e,t;return(0,a.Jh)(this,function(n){switch(n.label){case 0:return[4,(0,(e=this.props).dispatchEvent)("pullRefresh",e.data)];case 1:if(null==(t=n.sent())?void 0:t.prevented)return[2];return this.reload(),[2]}})})},t.prototype.handleChange=function(e,t,n,a){var o=this.props,i=o.store,r=o.onChange;"string"==typeof t&&t&&i.changeValue(t,e,a),null==r||r.apply(null,arguments)},t.prototype.handleBulkChange=function(e){var t,n;null==(n=null==(t=this.props.store)?void 0:t.updateData)||n.call(t,e)},t.prototype.renderHeader=function(){var e,t,n=this.props,r=n.title,s=n.subTitle,l=n.remark,d=n.remarkPlacement,p=n.headerClassName,c=n.toolbarClassName,h=n.toolbar,u=n.render,m=n.store,f=n.initApi,v=n.popOverContainer,y=n.env,g=n.classnames,C=n.regions,w=(n.translate,n.id),b=n.themeCss,D={onAction:this.handleAction,onQuery:f?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:m.loading};return((Array.isArray(C)?~C.indexOf("header"):r||s)&&(e=o.createElement("div",{className:g("Page-header",p,(0,i.GwQ)((0,a.pi)((0,a.pi)({},this.props),{name:"headerControlClassName",id:w,themeCss:b})))},r?o.createElement("h2",{className:g("Page-title",(0,i.GwQ)((0,a.pi)((0,a.pi)({},this.props),{name:"titleControlClassName",id:w,themeCss:b})))},u("title",r,D),l?u("remark",{type:"remark",tooltip:l,placement:d||"bottom",container:v||y.getModalContainer}):null):null,s&&o.createElement("small",{className:g("Page-subTitle")},u("subTitle",s,D)))),(Array.isArray(C)?~C.indexOf("toolbar"):h)&&(t=o.createElement("div",{className:g("Page-toolbar",c,(0,i.GwQ)((0,a.pi)((0,a.pi)({},this.props),{name:"toolbarControlClassName",id:w,themeCss:b})))},u("toolbar",h||"",D))),e&&t)?o.createElement("div",{className:g("Page-headerRow")},e,t):e||t},t.prototype.renderContent=function(e){var t=this.props,n=t.store,s=t.body,l=t.bodyClassName,d=t.render,p=t.classnames,c=t.showErrorMsg,h=t.regions,u=(t.translate,t.loadingConfig),m=(t.initApi,t.id),f=t.env,v=t.themeCss;return o.createElement("div",{className:p("Page-content")},o.createElement("div",{className:p("Page-main")},this.renderHeader(),o.createElement("div",{className:p("Page-body",l,(0,i.GwQ)((0,a.pi)((0,a.pi)({},this.props),{name:"bodyControlClassName",id:m,themeCss:v}))),role:"page-body"},o.createElement(r.$j,{size:"lg",overlay:!0,key:"info",show:n.loading,loadingConfig:u}),!f.forceSilenceInsideError&&n.error&&!1!==c?o.createElement(r.Vp,{level:"danger",showCloseButton:!0,onClose:n.clearMessage},n.msg):null,(Array.isArray(h)?~h.indexOf("body"):s)?d("body",s||"",e):null)))},t.prototype.render=function(){var e=this.props,t=e.className,n=e.store,s=(e.body,e.bodyClassName,e.render),l=e.aside,d=e.asideClassName,p=e.classnames,c=(e.showErrorMsg,e.initApi),h=e.regions,u=e.style,m=e.data,f=e.asideResizor,v=e.asideSticky,y=e.pullRefresh,g=e.mobileUI,C=e.translate,w=(e.loadingConfig,e.id),b=e.wrapperCustomStyle,D=e.env,N=e.themeCss,S=e.asidePosition,A={onAction:this.handleAction,onQuery:c?this.handleQuery:void 0,onChange:this.handleChange,onBulkChange:this.handleBulkChange,pageLoading:n.loading},k=Array.isArray(h)?~h.indexOf("aside"):l&&(!Array.isArray(l)||l.length),M=(0,i.uBL)(u,m),T=this.renderContent(A);return o.createElement("div",{className:p("Page",k?"Page--withSidebar":"",k&&v?"Page--asideSticky":"",k&&S?"Page--".concat(S,"Aside"):"",t,(0,i.GwQ)((0,a.pi)({name:"baseControlClassName",id:w,themeCss:N},this.props)),(0,i.GwQ)((0,a.pi)({name:"wrapperCustomStyle",id:w,themeCss:b},this.props))),onClick:this.handleClick,style:M},k?o.createElement("div",{className:p("Page-aside",f?"relative":"Page-aside--withWidth",d,(0,i.GwQ)((0,a.pi)((0,a.pi)({},this.props),{name:"asideControlClassName",id:w,themeCss:N})))},s("aside",l||"",(0,a.pi)((0,a.pi)({},A),"string"==typeof l?{inline:!1,className:"Page-asideTplWrapper"}:null)),f?o.createElement("div",{onMouseDown:this.handleResizeMouseDown,className:p("Page-asideResizor")}):null):null,g&&y&&!y.disabled?o.createElement(r.I8,(0,a.pi)({},y,{translate:C,onRefresh:this.handleRefresh}),T):T,s("dialog",(0,a.pi)((0,a.pi)({},n.action&&n.action.dialog),{type:"dialog"}),{key:"dialog",data:n.dialogData,onConfirm:this.handleDialogConfirm,onClose:this.handleDialogClose,show:n.dialogOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),s("drawer",(0,a.pi)((0,a.pi)({},n.action&&n.action.drawer),{type:"drawer"}),{key:"drawer",data:n.drawerData,onConfirm:this.handleDrawerConfirm,onClose:this.handleDrawerClose,show:n.drawerOpen,onAction:this.handleAction,onQuery:c?this.handleQuery:void 0}),o.createElement(i.cWM,(0,a.pi)({},this.props,{config:{wrapperCustomStyle:b,id:w,themeCss:N,classNames:[{key:"baseControlClassName",weights:{default:{important:!0},hover:{important:!0},active:{important:!0}}},{key:"bodyControlClassName"},{key:"headerControlClassName"},{key:"titleControlClassName"},{key:"toolbarControlClassName"},{key:"asideControlClassName"}]},env:D})))},t.defaultProps={asideClassName:"",bodyClassName:"",headerClassName:"",initFetch:!0,toolbarClassName:"",messages:{},asideSticky:!0,asidePosition:"left",pullRefresh:{disabled:!0}},t.propsList=["title","subTitle","initApi","initFetchOn","initFetch","headerClassName","bodyClassName","asideClassName","toolbarClassName","toolbar","body","aside","messages","style","showErrorMsg"],(0,a.gn)([i.NjZ,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[Object]),(0,a.w6)("design:returntype",void 0)],t.prototype,"handleResizeMouseDown",null),(0,a.gn)([i.NjZ,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[MouseEvent]),(0,a.w6)("design:returntype",void 0)],t.prototype,"handleResizeMouseMove",null),(0,a.gn)([i.NjZ,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[]),(0,a.w6)("design:returntype",void 0)],t.prototype,"handleResizeMouseUp",null),(0,a.gn)([i.NjZ,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",[]),(0,a.w6)("design:returntype",Promise)],t.prototype,"handleRefresh",null),t}(o.Component),d=function(e){function t(t,n){var a=e.call(this,t)||this;return n.registerComponent(a),a}return(0,a.ZT)(t,e),t.prototype.componentWillUnmount=function(){this.context.unRegisterComponent(this),e.prototype.componentWillUnmount.call(this)},t.prototype.reloadTarget=function(e,t){this.context.reload(e,t)},t.prototype.handleAction=function(t,n,o,i,r){return void 0===i&&(i=!1),(0,a.mG)(this,void 0,void 0,function(){var s,l;return(0,a.Jh)(this,function(d){switch(d.label){case 0:if(s=r||this.context,"reload"!==n.actionType)return[3,1];return n.target&&s.reload(n.target,o),[3,4];case 1:if(!n.target)return[3,2];return n.target.split(",").forEach(function(e){var t=s.getComponentByName(e);t&&t.doAction&&t.doAction((0,a.pi)((0,a.pi)({},n),{target:void 0}),o)}),[3,4];case 2:return[4,e.prototype.handleAction.call(this,t,n,o,i,r)];case 3:return l=d.sent(),n.reload&&~["url","link","jump"].indexOf(n.actionType)&&s.reload(n.reload,o),[2,l];case 4:return[2]}})})},t.prototype.handleDialogConfirm=function(t,n){for(var o,i,r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var l=this.props.store,d=l.action,p=null!=(o=n.reload)?o:d.reload,c=l.getDialogScoped()||this.context;e.prototype.handleDialogConfirm.apply(this,(0,a.ev)([t,n],(0,a.CR)(r),!1)),p?c.reload(p,l.data):(null==c?void 0:c.component)!==this&&(null==(i=c.component)?void 0:i.reload)?c.component.reload():this.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},t.prototype.handleDrawerConfirm=function(t,n){for(var a,o=this,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var s=this.props.store,l=s.action,d=null!=(a=n.reload)?a:l.reload,p=s.getDrawerScoped()||this.context;e.prototype.handleDrawerConfirm.call(this,t,n),setTimeout(function(){var e;d?p.reload(d,s.data):p.component!==o&&(null==(e=null==p?void 0:p.component)?void 0:e.reload)?p.component.reload():o.context.getComponents().filter(function(e){return"crud"===e.props.type}).forEach(function(e){return e.reload&&e.reload()})},300)},t.prototype.setData=function(e,t){return this.props.store.updateData(e,void 0,t)},t.prototype.getData=function(){return this.props.store.data},t.contextType=i.ZHe,t}(l),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,a.ZT)(t,e),t=(0,a.gn)([(0,i.Thl)({type:"page",storeType:i.Y5f.name,isolateScope:!0})],t)}(d)}}]);