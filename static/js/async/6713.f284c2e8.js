"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["6713"],{93992:function(e,t,n){n.r(t),n.d(t,{IconSelectControlRenderer:()=>g,default:()=>h});var o=n(9787),a=n(65758),l=n(84875),r=n.n(l),i=n(8427),c=n(47755),s=n(68333),p=n(66292),d=n.n(p),u=n(15707),h=function(e){function t(t){var n=e.call(this,t)||this;return n.state={activeTypeIndex:0,showModal:!1,tmpCheckIconId:null,searchValue:"",isRefreshLoading:!1},n.handleSearchValueChange=d()(n.handleSearchValueChange.bind(n),300),n}return(0,o.ZT)(t,e),t.prototype.getSvgName=function(e){var t;return"string"==typeof e?(null==(t=/data-name="(.*?)"/.exec(e))?void 0:t[1])||"":(null==e?void 0:e.name)||(null==e?void 0:e.id)||""},t.prototype.getSvgId=function(e){var t;return"string"==typeof e?(null==(t=/data-id="(.*?)"/.exec(e))?void 0:t[1])||"":(null==e?void 0:e.id)||""},t.prototype.getValueBySvg=function(e){var t;return e?"string"!=typeof e?(0,o.pi)((0,o.pi)({},e),{svg:null==(t=e.svg)?void 0:t.replace(/'/g,"")}):{name:this.getSvgName(e),id:this.getSvgId(e),svg:e.replace(/'/g,"")}:null},t.prototype.handleClick=function(){this.props.disabled||this.toggleModel(!0)},t.prototype.handleClear=function(e){e.preventDefault(),e.stopPropagation(),this.props.onChange&&this.props.onChange("")},t.prototype.renderInputArea=function(){var e=this.props,t=e.classPrefix,n=e.disabled,o=e.value,l=e.placeholder,i=e.clearable,c=this.getValueBySvg(o);return a.createElement("div",{className:r()("".concat(t,"IconSelectControl-input-area"))},a.createElement("div",{className:r()("".concat(t,"IconSelectControl-input-icon-show"))},a.createElement(s.JO,{icon:null==c?void 0:c.svg,className:"icon"})),a.createElement("span",{className:r()("".concat(t,"IconSelectControl-input-icon-id"))},null==c?void 0:c.name),i&&!n&&c?a.createElement("a",{onClick:this.handleClear,className:r()("".concat(t,"IconSelectControl-clear"))},a.createElement(s.JO,{icon:"input-clear",className:"icon"})):null,!c&&l&&a.createElement("span",{className:r()("".concat(t,"IconSelectControl-input-icon-placeholder"))},l)||null)},t.prototype.handleIconTypeClick=function(e,t){this.setState({activeTypeIndex:t})},t.prototype.renderIconTypes=function(){var e=this,t=this.props.classPrefix,n=u.svgIcons.map(function(e){return{id:e.groupId,label:e.name}});return a.createElement("ul",{className:r()("".concat(t,"IconSelectControl-type-list"))},n.map(function(t,n){return a.createElement("li",{key:t.id,onClick:function(){return e.handleIconTypeClick(t,n)},className:r()({active:n===e.state.activeTypeIndex})},t.label)}))},t.prototype.handleConfirm=function(){var e=this.state.tmpCheckIconId;if(this.props.returnSvg){var t=e&&e.svg||"";t=t.replace(/<svg/,'<svg data-name="'.concat(null==e?void 0:e.name,'" data-id="').concat(null==e?void 0:e.id,'"')),this.props.noSize&&(t=t.replace(/width=".*?"/,"").replace(/height=".*?"/,"")),this.props.onChange&&this.props.onChange(t)}else this.props.onChange&&this.props.onChange(e&&e.id?(0,o.pi)((0,o.pi)({},e),{id:"svg-"+e.id}):"");this.toggleModel(!1)},t.prototype.handleLocalUpload=function(e){return(0,o.mG)(this,void 0,void 0,function(){return(0,o.Jh)(this,function(t){return this.props.onChange&&this.props.onChange(e),this.toggleModel(!1),[2]})})},t.prototype.handleClickIconInModal=function(e){var t;this.setState({tmpCheckIconId:(null==e?void 0:e.id)===(null==(t=this.state.tmpCheckIconId)?void 0:t.id)?null:e})},t.prototype.renderIconList=function(e){var t=this,n=this.props,o=n.classPrefix,l=n.noDataTip,i=n.translate;return e&&e.length?a.createElement("ul",{className:r()("".concat(o,"IconSelectControl-icon-list"))},e.map(function(e,n){var l;return a.createElement("li",{key:e.id},a.createElement("div",{className:r()("".concat(o,"IconSelectControl-icon-list-item"),{active:(null==(l=t.state.tmpCheckIconId)?void 0:l.id)===e.id}),onClick:function(){return t.handleClickIconInModal(e)}},a.createElement("svg",null,a.createElement("use",{xlinkHref:"#".concat(e.id)})),a.createElement("div",{className:r()("".concat(o,"IconSelectControl-icon-list-item-info"))},a.createElement("p",{className:r()("".concat(o,"IconSelectControl-icon-list-item-info-name"))},e.name))))})):a.createElement("p",{className:r()("".concat(o,"IconSelectControl-icon-list-empty"))},i(l))},t.prototype.handleSearchValueChange=function(e){this.setState({searchValue:e})},t.prototype.handleRefreshIconList=function(){return(0,o.mG)(this,void 0,void 0,function(){var e;return(0,o.Jh)(this,function(t){switch(t.label){case 0:if(!((e=u.refreshIconList)&&"function"==typeof e))return[3,5];t.label=1;case 1:return t.trys.push([1,3,4,5]),this.setState({isRefreshLoading:!0}),[4,Promise.resolve(e())];case 2:return t.sent(),[3,5];case 3:return console.error(t.sent()),[3,5];case 4:return this.setState({isRefreshLoading:!1}),[7];case 5:return[2]}})})},t.prototype.renderModalContent=function(){var e=this.props,t=e.render,n=e.classPrefix,o=e.loadingConfig,l=(e.funcSchema,e.funcCom),c=this.getIconsByType(),p=this.state.searchValue,d=p?(0,i.Lu)(c,p,{keys:["name"],threshold:i.Lu.rankings.CONTAINS}):c;return a.createElement(a.Fragment,null,a.createElement(s.Rj,{className:r()("".concat(n,"IconSelectControl-Modal-search")),mini:!1,clearable:!0,onChange:this.handleSearchValueChange}),u.refreshIconList&&t("refresh-btn",{type:"button",icon:"fa fa-refresh"},{className:r()("".concat(n,"IconSelectControl-Modal-refresh")),onClick:this.handleRefreshIconList})||null,l?a.createElement("div",{className:r()("".concat(n,"IconSelectControl-Modal-func"))},a.createElement(l,{onUpload:this.handleLocalUpload})):null,a.createElement("div",{className:r()("".concat(n,"IconSelectControl-Modal-content"))},a.createElement(s.$j,{size:"lg",loadingConfig:o,overlay:!0,key:"info",show:this.state.isRefreshLoading}),a.createElement("div",{className:r()("".concat(n,"IconSelectControl-Modal-content-aside"))},this.renderIconTypes()),a.createElement("div",{className:r()("".concat(n,"IconSelectControl-Modal-content-main"))},this.renderIconList(d))))},t.prototype.getIconsByType=function(){return(null==u?void 0:u.svgIcons.length)&&u.svgIcons[this.state.activeTypeIndex].children||[]},t.prototype.toggleModel=function(e){var t=this.props.value,n="string"==typeof t?this.getValueBySvg(t):t;if(void 0===e)return void this.setState({showModal:!this.state.showModal,searchValue:""});this.setState({showModal:e,tmpCheckIconId:e&&(null==n?void 0:n.id)?(0,o.pi)((0,o.pi)({},n),{id:String(n.id).replace(/^svg-/,"")}):null,searchValue:""})},t.prototype.render=function(){var e=this,t=this.props,n=t.className,o=(t.style,t.classPrefix),l=t.disabled,i=t.translate;return a.createElement("div",{className:r()(n,"".concat(o,"IconSelectControl"),{"is-focused":this.state.showModal,"is-disabled":l})},a.createElement("div",{className:r()("".concat(o,"IconSelectControl-input")),onClick:this.handleClick},this.renderInputArea()),a.createElement(s.u_,{show:this.state.showModal,closeOnOutside:!0,closeOnEsc:!0,size:"lg",overlay:!0,onHide:function(){return e.toggleModel(!1)}},a.createElement(s.u_.Header,{onClose:function(){return e.toggleModel(!1)}},i("IconSelect.choice")),a.createElement(s.u_.Body,null,this.renderModalContent()),a.createElement(s.u_.Footer,null,a.createElement(s.zx,{type:"button",className:"m-l",onClick:function(){return e.toggleModel(!1)}},i("cancel")),a.createElement(s.zx,{type:"button",level:"primary",onClick:this.handleConfirm},i("confirm")))))},t.defaultProps={noDataTip:"placeholder.noData",clearable:!0},(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],t.prototype,"handleClick",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Object]),(0,o.w6)("design:returntype",void 0)],t.prototype,"handleClear",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],t.prototype,"renderInputArea",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Object,Number]),(0,o.w6)("design:returntype",void 0)],t.prototype,"handleIconTypeClick",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],t.prototype,"renderIconTypes",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],t.prototype,"handleConfirm",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[String]),(0,o.w6)("design:returntype",Promise)],t.prototype,"handleLocalUpload",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Array]),(0,o.w6)("design:returntype",void 0)],t.prototype,"renderIconList",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",Promise)],t.prototype,"handleRefreshIconList",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[]),(0,o.w6)("design:returntype",void 0)],t.prototype,"renderModalContent",null),(0,o.gn)([c.NjZ,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Boolean]),(0,o.w6)("design:returntype",void 0)],t.prototype,"toggleModel",null),t}(a.PureComponent),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t=(0,o.gn)([(0,c.xJW)({type:"icon-select"})],t)}(h)}}]);