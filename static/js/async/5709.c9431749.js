"use strict";(self.webpackChunkvue2_amis=self.webpackChunkvue2_amis||[]).push([["5709"],{21622:function(e,t,r){r.r(t),r.d(t,{PdfView:()=>o,PdfViewerRenderer:()=>p,default:()=>a});var n=r(9787),i=r(65758),s=r(47755),o=i.lazy(function(){return r.e("950").then(r.bind(r,17654))}),a=function(e){function t(t){var r=e.call(this,t)||this;return r.wrapper=i.createRef(),r.state={inited:!1,loading:!1,error:!1},r}return(0,n.ZT)(t,e),t.prototype.componentDidMount=function(){this.wrapper.current&&this.setState({width:this.wrapper.current.clientWidth-100}),this.renderPdf()},t.prototype.componentDidUpdate=function(e){var t=this,r=this.props;((0,s.rMT)(e.src,r.src,e.data,r.data)||(0,s.OgC)(r.src,r.data,"| raw")!==(0,s.OgC)(e.src,e.data,"| raw"))&&(this.abortLoad(),setTimeout(function(){t.fetchPdf()},0)),(0,s.E04)(r.data,r.name)&&(0,s.E04)(e.data,e.name)!==(0,s.E04)(r.data,r.name)&&(this.abortLoad(),this.renderPdf())},t.prototype.componentWillUnmount=function(){this.abortLoad()},t.prototype.abortLoad=function(){this.fetchCancel&&(this.fetchCancel("load canceled"),this.fetchCancel=void 0),this.reader&&(this.reader.abort(),this.reader=void 0)},t.prototype.renderPdf=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,r,i;return(0,n.Jh)(this,function(n){switch(n.label){case 0:if(t=(e=this.props).src,r=e.name,i=e.data,this.setState({error:!1}),!t)return[3,3];if(this.file)return[3,2];return[4,this.fetchPdf()];case 1:n.sent(),n.label=2;case 2:return[3,5];case 3:if(!(0,s.E04)(i,r))return[3,5];return[4,this.renderFormFile()];case 4:n.sent(),n.label=5;case 5:return[2]}})})},t.prototype.fetchPdf=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,r,i,o,a,p,d,l=this;return(0,n.Jh)(this,function(n){switch(n.label){case 0:if(t=(e=this.props).env,r=e.src,i=e.data,e.translate,r&&("string"==typeof(a=(0,s.OgC)(r,i,"| raw"))?o=a:"object"==typeof a&&"string"==typeof a.value&&(o=a.value)),!o)return console.warn("file src is empty"),[2];this.setState({inited:!0,loading:!0,error:!1}),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,t.fetcher(o,i,{responseType:"arraybuffer",cancelExecutor:function(e){return l.fetchCancel=e}})];case 2:return p=n.sent(),this.file=p.data,this.forceUpdate(),[3,5];case 3:return d=n.sent(),this.setState({error:!0}),console.error(d),[3,5];case 4:return this.setState({loading:!1}),[7];case 5:return[2]}})})},t.prototype.renderFormFile=function(){return(0,n.mG)(this,void 0,void 0,function(){var e,t,r,i,o,a=this;return(0,n.Jh)(this,function(n){return t=(e=this.props).name,r=e.data,i=(0,s.E04)(r,t),this.setState({inited:!0,loading:!0}),i instanceof File&&((o=new FileReader).onload=function(e){a.file=o.result,a.setState({loading:!1}),a.forceUpdate()},o.onerror=function(e){a.setState({error:!0})},o.readAsArrayBuffer(i),this.reader=o),[2]})})},t.prototype.renderEmpty=function(){var e=this.props,t=e.src,r=e.name;return t||r?null:i.createElement("svg",{width:"100%",height:"100",xmlns:"http://www.w3.org/2000/svg"},i.createElement("rect",{x:"0",y:"0",width:"100%",height:"100",style:{fill:"#F7F7F9"}}),i.createElement("text",{x:"50%",y:"50%",fontSize:"18",textAnchor:"middle",alignmentBaseline:"middle",fontFamily:"monospace, sans-serif",fill:"#555555"},"PDF viewer"))},t.prototype.renderError=function(){var e=this.props,t=e.src,r=e.translate;return this.state.error&&t?i.createElement("div",null,r("loadingFailed")+" url:"+t):null},t.prototype.renderTip=function(){return i.createElement("div",null,i.createElement("p",null,"[PdfViewer]: pdfjsWorkerSrc is required, Please set the `pdfjsWorkerSrc` in setGlobalOptions function."))},t.prototype.render=function(){var e=this.props,t=e.className,r=e.classnames,n=(e.translate,e.height),a=e.background,p=(0,s.lN9)().pdfjsWorkerSrc,d=this.state,l=d.loading,c=d.inited,u=d.error,h=Math.max(this.props.width||this.state.width,300);return i.createElement("div",{ref:this.wrapper},this.renderEmpty(),p?i.createElement(i.Suspense,{fallback:i.createElement("div",null,"...")},c&&!u?i.createElement(o,{file:this.file,loading:l,className:t,classnames:r,width:h,height:n,background:a}):null):this.renderTip(),this.renderError())},(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"abortLoad",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",Promise)],t.prototype,"renderPdf",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",Promise)],t.prototype,"fetchPdf",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",Promise)],t.prototype,"renderFormFile",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderEmpty",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderError",null),(0,n.gn)([s.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderTip",null),t}(i.Component),p=function(e){function t(t,r){var n=e.call(this,t)||this;return r.registerComponent(n),n}return(0,n.ZT)(t,e),t.prototype.componentWillUnmount=function(){var t;null==(t=e.prototype.componentWillUnmount)||t.call(this),this.context.unRegisterComponent(this)},t.contextType=s.ZHe,t=(0,n.gn)([(0,s.Thl)({type:"pdf-viewer"}),(0,n.w6)("design:paramtypes",[Object,Object])],t)}(a)}}]);