"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["9578"],{81950:function(e,t,a){a.r(t),a.d(t,{SubFormControlRenderer:()=>f,default:()=>v});var i,n=a(9787),o=a(65758),l=a(47755),r=a(84875),s=a.n(r),d=a(59245),p=a.n(d),m=a(19334),c=a.n(m),u=a(68333),h=a(65861),g=a(97326),b=function(e){return e?((i=i||document.createElement("div")).innerHTML=e,i.innerText):e},v=function(e){function t(t){var a=e.call(this,t)||this;return a.state={},a.id=(0,l.M8z)(),a.addItem=a.addItem.bind(a),a.removeItem=a.removeItem.bind(a),a.editSingle=a.editSingle.bind(a),a.open=a.open.bind(a),a.close=a.close.bind(a),a.dragTipRef=a.dragTipRef.bind(a),a.handleDialogConfirm=a.handleDialogConfirm.bind(a),a}return(0,n.ZT)(t,e),t.prototype.addItem=function(){this.setState({dialogData:(0,l.nW9)(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},t.prototype.removeItem=function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&((a=a.concat()).splice(t,1),this.props.onChange(a))},t.prototype.editSingle=function(){this.props.value?this.setState({dialogData:(0,l.nW9)(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},t.prototype.open=function(e){var t=parseInt(e.currentTarget.getAttribute("data-index"),10),a=this.props.value;Array.isArray(a)&&a[t]&&(this.tempValue=a[t],this.setState({dialogData:(0,l.nW9)(this.props.data,a[t]),dialogCtx:{mode:"edit",index:t}}))},t.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},t.prototype.handleDialogConfirm=function(e){var t=this.props,a=t.multiple,i=t.onChange,o=t.value,l=this.state.dialogCtx;if(a){var r=Array.isArray(o)?o.concat():[];(null==l?void 0:l.mode)==="add"?r.push((0,n.pi)({},e[0])):r[l.index]=(0,n.pi)((0,n.pi)({},r[l.index]),e[0]),i(r)}else i((0,n.pi)((0,n.pi)({},o),e[0]));this.close()},t.prototype.handlePopupConfirm=function(){var e=this.tempValue,t=this.props,a=t.multiple,i=t.onChange,o=t.value,l=this.state.dialogCtx;if(a){var r=Array.isArray(o)?o.concat():[];(null==l?void 0:l.mode)==="add"?r.push((0,n.pi)({},e)):r[l.index]=(0,n.pi)((0,n.pi)({},r[l.index]),e),i(r)}else i((0,n.pi)((0,n.pi)({},o),e));this.close()},t.prototype.dragTipRef=function(e){!this.dragTip&&e?this.initDragging():this.dragTip&&!e&&this.destroyDragging(),this.dragTip=e},t.prototype.initDragging=function(){var e=this,t=this.props.classPrefix,a=this.props.submitOnChange,i=(0,g.findDOMNode)(this);this.sortable=new h.ZP(i.querySelector(".".concat(t,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(t,"SubForm-valueDragBar"),ghostClass:"".concat(t,"SubForm-value--dragging"),onEnd:function(t){if(t.newIndex!==t.oldIndex){var i=t.to;t.oldIndex<i.childNodes.length-1?i.insertBefore(t.item,i.childNodes[t.oldIndex>t.newIndex?t.oldIndex+1:t.oldIndex]):i.appendChild(t.item);var n=e.props.value;if(Array.isArray(n)){var o=n.concat();o.splice(t.newIndex,0,o.splice(t.oldIndex,1)[0]),e.props.onChange(o,a,!0)}}}})},t.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},t.prototype.buildDialogSchema=function(){var e=this.props.form,t=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return(0,n.pi)((0,n.pi)({},c()(e,t)),{type:"dialog",body:(0,n.pi)((0,n.pi)({type:"form",canAccessSuperData:!1},p()(e,t)),{inheritData:!1})})},t.prototype.buildFormSchema=function(){var e=this.props.form;return(0,n.pi)((0,n.pi)({type:"form",canAccessSuperData:!1},p()(e,["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"])),{inheritData:!1})},t.prototype.renderMultipe=function(){var e=this,t=this.props,a=t.addButtonClassName,i=t.itemClassName,r=t.itemsClassName,s=t.disabled,d=t.maxLength,p=t.labelField,m=t.defaultLabel,c=t.value,h=t.btnLabel,g=t.render,v=t.data,f=t.translate,y=t.classnames,C=t.placeholder,S=t.draggable,N=t.draggableTip,x=t.addable,E=t.removable,F=t.minLength,I=t.addButtonText,D=t.testIdBuilder;return o.createElement(o.Fragment,null,Array.isArray(c)&&c.length?o.createElement("div",{className:y("SubForm-values",r),key:"values"},c.map(function(t,a){return o.createElement("div",(0,n.pi)({className:y("SubForm-value",{"is-disabled":s},i),key:a},null==D?void 0:D.getChild("item-".concat(a)).getTestId()),S&&c.length>1?o.createElement("a",{className:y("SubForm-valueDragBar")},o.createElement(u.JO,{icon:"drag-bar",className:y("icon")})):null,o.createElement("span",{className:y("SubForm-valueLabel")},h&&g("label",{type:"tpl",tpl:f(h)},{data:(0,l.nW9)(v,t)}),!h&&(t&&p&&t[p]&&b(t[p])||f(m))),o.createElement("a",{"data-index":a,onClick:e.open,className:y("SubForm-valueEdit")},o.createElement(u.JO,{icon:"pencil",className:"icon"})),s||!1===E||F&&!(c.length>F)?null:o.createElement("a",{"data-index":a,className:y("SubForm-valueDel"),onClick:e.removeItem},o.createElement(u.JO,{icon:"close",className:"icon"})))})):o.createElement("div",{className:y("SubForm-placeholder"),key:"placeholder"},f(C||"placeholder.empty")),o.createElement("div",{key:"toolbar",className:y("SubForm-toolbar")},!1!==x?o.createElement("button",(0,n.pi)({type:"button",onClick:this.addItem,className:y("Button SubForm-addBtn",a),disabled:s||!!(d&&Array.isArray(c)&&c.length>=d)},null==D?void 0:D.getChild("add-button").getTestId()),o.createElement(u.JO,{icon:"plus",className:"icon"}),o.createElement("span",null,f(I||"SubForm.add"))):null,S&&Array.isArray(c)&&c.length>1?o.createElement("span",{className:y("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(c)&&c.length>1?f(N):""):null))},t.prototype.renderSingle=function(){var e=this.props,t=e.classnames,a=e.itemsClassName,i=e.itemClassName,r=e.disabled,s=e.value,d=e.labelField,p=e.defaultLabel,m=e.btnLabel,c=e.render,h=e.data,g=e.translate,v=e.testIdBuilder,f=null==v?void 0:v.getChild("edit-single");return o.createElement("div",{className:t("SubForm-values",a),key:"values"},o.createElement("div",(0,n.pi)({className:t("SubForm-value",{"is-disabled":r},i),onClick:this.editSingle,"data-tooltip":g("SubForm.editDetail"),"data-position":"bottom"},null==f?void 0:f.getTestId()),o.createElement("span",{className:t("SubForm-valueLabel")},m&&c("label",{type:"tpl",tpl:g(m)},{data:(0,l.nW9)(h,s)}),!m&&(s&&d&&s[d]&&b(s[d])||g(p))),o.createElement("a",(0,n.pi)({className:t("SubForm-valueEdit")},null==f?void 0:f.getChild("icon").getTestId()),o.createElement(u.JO,{icon:"pencil",className:"icon"}))))},t.prototype.render=function(){var e=this,t=this.props,a=t.multiple,i=t.classPrefix,n=t.className,l=(t.style,t.render),r=t.mobileUI,d=t.env,p=t.popOverContainer,m=this.state.dialogData,c=this.state.dialogCtx;return o.createElement("div",{className:s()("".concat(i,"SubFormControl"),n)},a?this.renderMultipe():this.renderSingle(),r?o.createElement(u.N4,{isShow:!!c,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:r?null==d?void 0:d.getModalContainer:p||d.getModalContainer},o.createElement("div",{className:"flex-1 pl-10 pr-10"},l("form",this.buildFormSchema(),{data:m,formStore:void 0,wrapWithPanel:!1,onChange:function(t){e.tempValue=t}}))):l("modal",this.buildDialogSchema(),{show:!!c,onClose:this.close,onConfirm:this.handleDialogConfirm,data:m,formStore:void 0}))},t.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},t.propsList=["form","formStore"],(0,n.gn)([l.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"handlePopupConfirm",null),t}(o.PureComponent),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t=(0,n.gn)([(0,l.xJW)({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],t)}(v)}}]);