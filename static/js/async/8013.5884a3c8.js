"use strict";(self.webpackChunkvue2_demo=self.webpackChunkvue2_demo||[]).push([["8013"],{53801:function(e,t,i){i.r(t),i.d(t,{TreeControlRenderer:()=>f,default:()=>g});var n=i(9787),r=i(65758),o=i(59245),l=i.n(o),a=i(66292),s=i.n(a),d=i(84875),p=i.n(d),h=i(8427),u=i(68333),c=i(66203),m=i(47755),v=i(81415),g=function(e){function t(t){var i,n=this;return(n=e.call(this,t)||this).rootRef=r.createRef(),n.state={keyword:"",filteredOptions:null!=(i=n.props.options)?i:[],allowSearch:!1,virtualListHeight:0,othersHeight:0},n.handleSearch=s()(n.handleSearch.bind(n),250,{trailing:!0,leading:!1}),n}return(0,n.ZT)(t,e),t.prototype.componentDidMount=function(){var e,t=this;this.props.heightAuto&&(this.initOthersHeight(),this.handleVirtualListHeight(),this.unSensor=(0,m.Adl)(null==(e=this.rootRef.current)?void 0:e.parentElement,function(){t.handleVirtualListHeight()},!1,"height"))},t.prototype.componentDidUpdate=function(e,t){var i=this.props,n=this.state,r=this.state.keyword;if(e.options!==i.options||e.searchable!==i.searchable){var o=i.options,l=i.searchable;this.setState({filteredOptions:l&&r?this.filterOptions(o,r):o})}(0,m.aGv)(["label","searchable","creatable","hideRoot","themeCss","wrapperCustomStyle","heightAuto"],e,i)&&i.heightAuto&&this.initOthersHeight(),t.othersHeight!==n.othersHeight&&i.heightAuto&&this.handleVirtualListHeight()},t.prototype.componentWillUnmount=function(){this.unSensor&&(this.unSensor(),delete this.unSensor)},t.prototype.initOthersHeight=function(){var e,t,i=this,n=this.rootRef.current,r=null==(e=this.rootRef.current)?void 0:e.parentElement,o=this.treeRef.virtualListRef.current,l=null==(t=this.treeRef.virtualListRef.current)?void 0:t.parentElement;if(r&&l&&o&&n){var a=function(e,t){return Array.from(e.children).filter(function(e){return e!==t}).reduce(function(e,t){return e+t.offsetHeight+i.getElementVerticalMargin(t)},0)},s=a(r,n)+this.getElementVerticalMargin(n)+a(l,o)+n.offsetHeight-l.offsetHeight;this.setState({othersHeight:s})}},t.prototype.handleVirtualListHeight=function(){var e,t=this.state.othersHeight,i=null==(e=this.rootRef.current)?void 0:e.parentElement;if(i){var n=i.offsetHeight-t;this.setState({virtualListHeight:n>0?n:0})}},t.prototype.getElementVerticalMargin=function(e){var t=window.getComputedStyle(e,null);return parseInt(t.marginTop||"0")+parseInt(t.marginBottom||"0")},t.prototype.reload=function(){var e=this.props.reloadOptions;e&&e()},t.prototype.doAction=function(e,t,i){var n,r,o,l,a,s,d,p,h,u,c,v=null==e?void 0:e.actionType,g=this.props,f=g.resetValue,y=g.onChange,w=g.formStore,b=g.store,C=g.name;if("clear"===v)null==y||y("");else if("reset"===v){var O=null!=(r=(0,m.E04)(null!=(n=null==w?void 0:w.pristine)?n:null==b?void 0:b.pristine,C))?r:f;null==y||y(null!=O?O:"")}else"expand"===e.actionType?this.treeRef.syncUnFolded(this.props,null==(o=e.args)?void 0:o.openLevel):"collapse"===e.actionType?this.treeRef.syncUnFolded(this.props,(null==(l=e.args)?void 0:l.closeLevel)||0):"add"===e.actionType?this.addItemFromAction(null==(a=e.args)?void 0:a.item,null==(s=e.args)?void 0:s.parentValue):"edit"===e.actionType?this.editItemFromAction(null==(d=e.args)?void 0:d.item,null==(p=e.args)?void 0:p.originValue):"delete"===e.actionType?this.deleteItemFromAction(null==(h=e.args)?void 0:h.value):"reload"===e.actionType?this.reload():"search"===v&&(this.setState({allowSearch:!!(null==(u=e.args)?void 0:u.keyword)}),this.handleSearch(null==(c=e.args)?void 0:c.keyword))},t.prototype.resolveOption=function(e,t){var i=this;return(0,m.hEs)(e,function(e){var n=i.props.valueField||"value";return((0,m.rIu)(e,n)?e[n]:"")===t})},t.prototype.addItemFromAction=function(e,t){var i=this.props,n=i.onAdd,r=i.options,o=i.valueField,l=(0,m.L$8)(r,function(e){var i=o||"value";return((0,m.rIu)(e,i)?e[i]:"")===t})||[];n&&n(l.concat(0),e,!0)},t.prototype.editItemFromAction=function(e,t){var i=this.props,r=i.onEdit,o=i.options,l=this.resolveOption(o,t);r&&l&&r((0,n.pi)((0,n.pi)({},e),{originValue:t}),l,!0)},t.prototype.deleteItemFromAction=function(e){var t=this.props,i=t.onDelete,n=t.options,r=this.resolveOption(n,e);i&&r&&i(r)},t.prototype.filterOptions=function(e,t){var i=this,r=this.props,o=r.labelField,l=r.valueField;return e.map(function(e){if((e=(0,n.pi)({},e)).visible=!!(0,h.Lu)([e],t,{keys:[o||"label",l||"value"],threshold:h.Lu.rankings.CONTAINS}).length,!e.visible&&e.children){e.children=i.filterOptions(e.children,t);var r=e.children.filter(function(e){return e.visible}).length;e.visible=!!r}return e.visible&&(e.collapsed=!1),e})},t.prototype.handleChange=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,r,o,l,a,s,d,p,h,u,v,g,f,y,w,b,C;return(0,n.Jh)(this,function(n){switch(n.label){case 0:return i=(t=this.props).onChange,r=t.searchable,o=t.options,l=t.dispatchEvent,a=t.multiple,s=t.delimiter,d=t.valueField,p=t.selectedOptions,h=t.joinValues,u=t.extractValue,g=(v=this.state).filteredOptions,f=v.allowSearch,y=r||f?g:o,w=(0,c.G0)(e,{multiple:a,delimiter:s,valueField:d,options:g}),b=a?null:w[0],a&&(r||f)&&p.length&&(p.forEach(function(e){(0,m.hEs)(g,function(t){return t[d||"value"]===e[d||"value"]})||w.push(e)}),e=w.map(function(e){return u||h?e[d||"value"]:e}),h&&(e=e.join(s||","))),[4,l("change",(0,m.vXk)(this.props,{value:e,item:b,items:y,selectedItems:w}))];case 1:if(null==(C=n.sent())?void 0:C.prevented)return[2];return i&&i(e),[2]}})})},t.prototype.handleNodeClick=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,r,o;return(0,n.Jh)(this,function(n){switch(n.label){case 0:return i=(t=this.props).dispatchEvent,r=t.data,[4,i("itemClick",(0,m.nW9)(r,{item:e}))];case 1:return null==(o=n.sent())||o.prevented,[2]}})})},t.prototype.handleSearch=function(e){return(0,n.mG)(this,void 0,void 0,function(){var t,i,r,o,l,a,s,d,p,h;return(0,n.Jh)(this,function(n){switch(n.label){case 0:if(i=(t=this.props).searchApi,r=t.options,o=t.env,l=t.data,a=t.translate,s=[],!(0,m.X1t)(i))return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.fetcher(i,(0,m.nW9)(l,{term:e}))];case 2:if(!(d=n.sent()).ok)throw Error(a(d.msg||"networkError"));if(!Array.isArray(p=d.data.options||d.data.items||d.data))throw Error(a("Tree.invalidArray"));return s=p,[3,4];case 3:return h=n.sent(),!o.isCancel(h)&&(i.silent||o.notify("error",h.message)),[3,4];case 4:return[3,6];case 5:e&&(s=this.filterOptions(r,e)),n.label=6;case 6:return this.setState({keyword:e,filteredOptions:e?s:r}),[2]}})})},t.prototype.domRef=function(e){this.treeRef=e},t.prototype.validate=function(){var e=this.props,t=e.value,i=e.minLength,n=e.maxLength,r=e.delimiter,o=Array.isArray(t)?t:(t?String(t):"").split(r||",");return i&&o.length<i?"已选择数量低于设定的最小个数".concat(i,"，请选择更多的选项。"):n&&o.length>n?"已选择数量超出设定的最大个数".concat(n,"，请取消选择超出的选项。"):void 0},t.prototype.renderOptionItem=function(e,t){var i=this.props,r=i.menuTpl,o=i.render,l=i.data;return o("option/".concat(t.index),r,{data:(0,m.nW9)((0,m.nW9)(l,(0,n.pi)({},t)),e)})},t.prototype.renderItemActions=function(e,t){var i=this.props,r=i.itemActions,o=i.data;return(0,i.render)("action/".concat(t.index),r||"",{data:(0,m.nW9)((0,m.nW9)(o,(0,n.pi)({},t)),e)})},t.prototype.renderSearch=function(){var e=this.props,t=e.classPrefix,i=e.searchConfig,o=e.mobileUI,a=e.testIdBuilder;return r.createElement(u.Rj,(0,n.pi)({className:p()("".concat(t,"TreeControl-searchbox"),null==i?void 0:i.className,{"is-sticky":null==i?void 0:i.sticky}),mini:!1,clearable:!0},l()(i,"className","sticky"),{onSearch:this.handleSearch,mobileUI:o,testIdBuilder:null==a?void 0:a.getChild("search")}))},t.prototype.render=function(){var e=this.props,t=e.className,i=e.treeContainerClassName,o=e.classPrefix,l=e.value,a=e.enableNodePath,s=e.pathSeparator,d=e.disabled,h=e.joinValues,c=e.extractValue,v=e.delimiter,g=e.placeholder,f=e.options,y=e.multiple,w=e.valueField,b=e.initiallyOpen,C=e.unfoldedLevel,O=e.withChildren,F=e.onlyChildren,I=e.onlyLeaf,A=e.loading,S=e.hideRoot,T=e.rootLabel,k=e.autoCheckChildren,N=e.autoCancelParent,j=e.cascade,E=e.rootValue,H=e.showIcon,R=e.showRadio,L=e.showOutline,V=e.onAdd,x=e.creatable,P=e.createTip,Z=e.addControls,D=e.onEdit,U=e.editable,B=e.editTip,W=e.editControls,G=e.removable,M=e.removeTip,J=e.onDelete,Q=e.rootCreatable,X=e.rootCreateTip,$=e.labelField,_=e.iconField,z=e.deferField,q=e.nodePath,K=e.deferLoad,Y=e.expandTreeOptions,ee=e.translate,et=e.data,ei=e.virtualThreshold,en=e.itemHeight,er=e.loadingConfig,eo=e.menuTpl,el=e.enableDefaultIcon,ea=e.searchable,es=e.searchConfig,ed=void 0===es?{}:es,ep=e.heightAuto,eh=e.mobileUI,eu=e.testIdBuilder,ec=e.nodeBehavior,em=e.itemActions,ev=e.id,eg=e.wrapperCustomStyle,ef=e.themeCss,ey=e.env,ew=this.props.highlightTxt,eb=this.state,eC=eb.filteredOptions,eO=eb.keyword,eF=eb.allowSearch,eI=eb.virtualListHeight;(0,m.SSQ)(ew)&&(ew=(0,m.OgC)(ew,et));var eA=r.createElement(u.mp,{classPrefix:o,onRef:this.domRef,labelField:$,valueField:w,iconField:_,deferField:z,disabled:d,onChange:this.handleChange,onHandleNodeClick:this.handleNodeClick,joinValues:h,extractValue:c,delimiter:v,placeholder:ee(g),options:ea||eF?eC:f,highlightTxt:ea||eF?eO:ew,multiple:y,initiallyOpen:b,unfoldedLevel:C,withChildren:O,onlyChildren:F,onlyLeaf:I,hideRoot:S,rootLabel:ee(T),rootValue:E,showIcon:H,showRadio:R,showOutline:L,autoCheckChildren:k,autoCancelParent:N,cascade:j,foldedField:"collapsed",value:l||"",nodePath:q,enableNodePath:a,pathSeparator:void 0===s?"/":s,selfDisabledAffectChildren:!1,onAdd:V,creatable:x,createTip:P,rootCreatable:Q,rootCreateTip:X,onEdit:D,editable:U,editTip:B,removable:G,removeTip:M,onDelete:J,bultinCUD:!Z&&!W,onDeferLoad:K,onExpandTree:Y,virtualThreshold:ei,virtualHeight:(0,m.He2)(eI)>=0?(0,m.He2)(eI):void 0,itemHeight:(0,m.He2)(en)>0?(0,m.He2)(en):void 0,itemRender:eo?this.renderOptionItem:void 0,enableDefaultIcon:el,mobileUI:eh,nodeBehavior:ec,itemActionsRender:em?this.renderItemActions:void 0,actionClassName:p()((0,m.GwQ)((0,n.pi)((0,n.pi)({},this.props),{name:"actionControlClassName",id:ev,themeCss:ef}))),testIdBuilder:null==eu?void 0:eu.getChild("tree")});return r.createElement(r.Fragment,null,r.createElement("div",(0,n.pi)({ref:this.rootRef,className:p()("".concat(o,"TreeControl"),t,i,{"is-sticky":ea&&(null==ed?void 0:ed.sticky),"h-auto":ep})},null==eu?void 0:eu.getChild("control").getTestId()),r.createElement(u.$j,{size:"sm",key:"info",show:A,loadingConfig:er}),A?null:ea?r.createElement(r.Fragment,null,this.renderSearch(),eA):eA),r.createElement(m.cWM,(0,n.pi)({},this.props,{config:{wrapperCustomStyle:eg,id:ev,themeCss:ef,classNames:[{key:"actionControlClassName"}]},env:ey})))},t.defaultProps={placeholder:"placeholder.noData",multiple:!1,rootLabel:"Tree.root",rootValue:"",showIcon:!0,enableNodePath:!1,pathSeparator:"/"},(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"addItemFromAction",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"editItemFromAction",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"deleteItemFromAction",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],t.prototype,"handleChange",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",Promise)],t.prototype,"handleNodeClick",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"domRef",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderOptionItem",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[Object,Object]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderItemActions",null),(0,n.gn)([m.NjZ,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"renderSearch",null),(0,n.gn)([(0,v.i)(),(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",[]),(0,n.w6)("design:returntype",void 0)],t.prototype,"render",null),t}(r.Component),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t=(0,n.gn)([(0,m.oZB)({type:"input-tree"})],t)}(g)}}]);